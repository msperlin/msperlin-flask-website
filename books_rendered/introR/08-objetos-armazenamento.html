<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introdução ao R - 8&nbsp; Dataframes e outros Objetos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-objetos-basicos.html" rel="next">
<link href="./07-importacao-internet.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FR8PLMG1G7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FR8PLMG1G7');
</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-objetos-armazenamento.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dataframes e outros Objetos</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introdução ao R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introdução.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-como-o-r-funciona.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Como o R Funciona?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introdução ao RStudio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-pacotes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pacotes do R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-interagindo-computador-internet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Interagindo com o Sistema Operacional e a Internet</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-importacao-exportacao-dados-locais.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Importação e Exportação de Dados Locais</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-importacao-internet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Importação de Dados via Pacotes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-objetos-armazenamento.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dataframes e outros Objetos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-objetos-basicos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">As Classes Básicas de Objetos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-intro-programacao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introdução a Programação com o R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências Bibliográficas</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#dataframes" id="toc-dataframes" class="nav-link active" data-scroll-target="#dataframes"><span class="header-section-number">8.1</span> <code>Dataframes</code></a>
  <ul class="collapse">
  <li><a href="#criando-dataframes" id="toc-criando-dataframes" class="nav-link" data-scroll-target="#criando-dataframes"><span class="header-section-number">8.1.1</span> Criando <code>dataframes</code></a></li>
  <li><a href="#inspecionando-um-dataframe" id="toc-inspecionando-um-dataframe" class="nav-link" data-scroll-target="#inspecionando-um-dataframe"><span class="header-section-number">8.1.2</span> Inspecionando um <code>dataframe</code></a></li>
  <li><a href="#operador-de-pipeline" id="toc-operador-de-pipeline" class="nav-link" data-scroll-target="#operador-de-pipeline"><span class="header-section-number">8.1.3</span> Operador de <em>pipeline</em></a></li>
  <li><a href="#acessando-colunas" id="toc-acessando-colunas" class="nav-link" data-scroll-target="#acessando-colunas"><span class="header-section-number">8.1.4</span> Acessando Colunas</a></li>
  <li><a href="#modificando-um-dataframe" id="toc-modificando-um-dataframe" class="nav-link" data-scroll-target="#modificando-um-dataframe"><span class="header-section-number">8.1.5</span> Modificando um <code>dataframe</code></a></li>
  <li><a href="#filtrando-um-dataframe" id="toc-filtrando-um-dataframe" class="nav-link" data-scroll-target="#filtrando-um-dataframe"><span class="header-section-number">8.1.6</span> Filtrando um <code>dataframe</code></a></li>
  <li><a href="#ordenando-um-dataframe" id="toc-ordenando-um-dataframe" class="nav-link" data-scroll-target="#ordenando-um-dataframe"><span class="header-section-number">8.1.7</span> Ordenando um <code>dataframe</code></a></li>
  <li><a href="#combinando-e-agregando-dataframes" id="toc-combinando-e-agregando-dataframes" class="nav-link" data-scroll-target="#combinando-e-agregando-dataframes"><span class="header-section-number">8.1.8</span> Combinando e Agregando <code>dataframes</code></a></li>
  <li><a href="#extensões-ao-dataframe" id="toc-extensões-ao-dataframe" class="nav-link" data-scroll-target="#extensões-ao-dataframe"><span class="header-section-number">8.1.9</span> Extensões ao <code>dataframe</code></a></li>
  <li><a href="#outras-funções-úteis" id="toc-outras-funções-úteis" class="nav-link" data-scroll-target="#outras-funções-úteis"><span class="header-section-number">8.1.10</span> Outras Funções Úteis</a></li>
  </ul></li>
  <li><a href="#listas" id="toc-listas" class="nav-link" data-scroll-target="#listas"><span class="header-section-number">8.2</span> Listas</a>
  <ul class="collapse">
  <li><a href="#criando-listas" id="toc-criando-listas" class="nav-link" data-scroll-target="#criando-listas"><span class="header-section-number">8.2.1</span> Criando Listas</a></li>
  <li><a href="#acessando-os-elementos-de-uma-lista" id="toc-acessando-os-elementos-de-uma-lista" class="nav-link" data-scroll-target="#acessando-os-elementos-de-uma-lista"><span class="header-section-number">8.2.2</span> Acessando os Elementos de uma Lista</a></li>
  <li><a href="#adicionando-e-removendo-elementos-de-uma-lista" id="toc-adicionando-e-removendo-elementos-de-uma-lista" class="nav-link" data-scroll-target="#adicionando-e-removendo-elementos-de-uma-lista"><span class="header-section-number">8.2.3</span> Adicionando e Removendo Elementos de uma Lista</a></li>
  <li><a href="#processando-os-elementos-de-uma-lista" id="toc-processando-os-elementos-de-uma-lista" class="nav-link" data-scroll-target="#processando-os-elementos-de-uma-lista"><span class="header-section-number">8.2.4</span> Processando os Elementos de uma Lista</a></li>
  <li><a href="#outras-funções-úteis-1" id="toc-outras-funções-úteis-1" class="nav-link" data-scroll-target="#outras-funções-úteis-1"><span class="header-section-number">8.2.5</span> Outras Funções Úteis</a></li>
  </ul></li>
  <li><a href="#exerc-classe-estrutura" id="toc-exerc-classe-estrutura" class="nav-link" data-scroll-target="#exerc-classe-estrutura"><span class="header-section-number">8.3</span> Exercícios</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-dataframes" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dataframes e outros Objetos</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>No R, tudo é um objeto</strong> e cada classe de objeto tem propriedades diferentes. Por exemplo, um <code>dataframe</code> pode ser incrementado com novas colunas ou linhas. Uma coluna numérica de um <code>dataframe</code> pode interagir com outros valores numéricos através de operações de multiplicação, divisão e soma. Para colunas com textos, porém, tal propriedade não é válida, uma vez que não faz sentido somar um valor numérico a um texto ou dividir um texto por outro. Entretanto, a classe de texto tem outras propriedades, como a que permite procurar uma determinada sequência textual dentro de um texto maior, a manipulação de partes do texto e a substituição de caracteres específicos, dentre tantas outras possibilidades. <strong>Um dos aspectos mais importantes no trabalho com o R é o aprendizado das classes de objetos e as suas funcionalidades</strong>.</p>
<p>As classes básicas de objetos no R inclui valores numéricos, caracteres (texto), fatores, datas, entre vários outros casos. Na prática, porém, as classes básicas são armazenadas em estruturas de dados mais complexas, tal como <code>dataframes</code> e listas. Isso organiza e facilita o trabalho. Imagine realizar um estudo sobre as <em>63</em> ações que compõem o índice Ibovespa, onde a base de dados é composta por preços e volumes negociados ao longo de um ano. Caso fôssemos criar um vetor numérico de preços e de volumes para cada ação, teríamos uma quantidade de <em>126</em> objetos para lidar no nosso ambiente do R. Apesar de ser possível trabalhar dessa forma, o código resultante seria desorganizado, difícil de entender e passível de uma série de erros.</p>
<p>Uma maneira mais simples de organizar os nossos dados é criar um objeto com o nome <code>my_data</code> e alocar todos os preços e volumes ali. Todas as informações necessárias para executar a pesquisa estariam nesse objeto, facilitando a importação e exportação dos dados. Esses objetos que armazenam outros objetos de classe básica constituem a classe de estrutura de dados. Nessa classificação, estão incluídas tabelas (<code>dataframes</code>) e listas (<code>list</code>).</p>
<section id="dataframes" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="dataframes"><span class="header-section-number">8.1</span> <code>Dataframes</code></h2>
<p>Traduzindo para o português, <code>dataframe</code> significa “estrutura ou organização de dados”. Grosso modo, um objeto da classe <code>dataframe</code> nada mais é do que uma tabela com linhas e colunas. Sem dúvida, <strong>o <code>dataframe</code> é o principal objeto utilizado no trabalho com o R e o mais importante de se estudar</strong>. Dados externos são, grande maioria dos casos, importados para o R no formato de tabelas. É na manipulação desses que gastará maior parte do tempo realizando a sua análise. Internamente, um <code>dataframe</code> é um tipo especial de lista, onde cada coluna é um vetor atômico com o mesmo número de elementos, porém com sua própria classe. Podemos organizar em um <code>dataframe</code> dados de texto juntamente com números, por exemplo.</p>
<p>Note que o formato tabular força a sincronização dos dados no sentido de linhas, isto é, cada caso de cada variável deve ser pareado com casos de outras variáveis. Apesar de simples, esse tipo de estruturação de dados é intuitiva e pode acomodar uma variedade de informações. Cada acréscimo de dados (informações) incrementa as linhas e cada novo tipo de informação incrementa as colunas da tabela.</p>
<p>Um dos pontos positivos na utilização do <code>dataframe</code> para a acomodação de dados é que funções de diferentes pacotes irão funcionar a partir dessa classe de objetos. Por exemplo, o pacote de manipulação de dados <strong>{dplyr}</strong> <span class="citation" data-cites="R-dplyr">(<a href="99-references.html#ref-R-dplyr" role="doc-biblioref">Wickham et al. 2023</a>)</span>, assim como o pacote de criação de figuras <code>ggplot2</code>, funcionam a partir de um <code>dataframe</code>. Esse objeto, portanto, está no centro de uma série de funcionalidades do R e, sem dúvida, é uma classe de objeto extremamente importante para aprender a utilizar corretamente.</p>
<p>O objeto <code>dataframe</code> é uma das classes nativas do R e vem implementado no pacote <strong>{base}</strong> <span class="citation" data-cites="R-base">(<a href="99-references.html#ref-R-base" role="doc-biblioref">R Core Team 2023</a>)</span>. Entretanto, o universe <strong>{tidyverse}</strong> <span class="citation" data-cites="R-tidyverse">(<a href="99-references.html#ref-R-tidyverse" role="doc-biblioref">Wickham 2023</a>)</span> oferece sua própria versão de um <code>dataframe</code>, chamada <code>tibble</code>, a qual é utilizada sistematicamente em todos pacotes do <strong>{tidyverse}</strong> <span class="citation" data-cites="R-tidyverse">(<a href="99-references.html#ref-R-tidyverse" role="doc-biblioref">Wickham 2023</a>)</span>. A conversão de um <code>dataframe</code> para <code>tibble</code> é interna e automática. O <code>tibble</code> possui propriedades mais flexíveis que <code>dataframes</code> nativos, facilitando de forma significativa o seu uso. Seguindo a nossa preferência para o <strong>{tidyverse}</strong> <span class="citation" data-cites="R-tidyverse">(<a href="99-references.html#ref-R-tidyverse" role="doc-biblioref">Wickham 2023</a>)</span>, a partir de agora iremos utilizar <code>tibbles</code> como representantes de <code>dataframes</code>.</p>
<section id="criando-dataframes" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="criando-dataframes"><span class="header-section-number">8.1.1</span> Criando <code>dataframes</code></h3>
<p>A criação de um <code>dataframe</code> do tipo <code>tibble</code> ocorre a partir da função <code>tibble</code>. Note que a criação de um <code>dataframe</code> nativo ocorre com a função <strong>data.frame()</strong> , enquanto a criação do <code>tibble</code> parte da função <code>tibble::tibble</code> ou <strong>dplyr</strong>::<strong>tibble()</strong> . Para manter o código mais limpo, iremos dar preferência a <strong>dplyr</strong>::<strong>tibble()</strong> e utilizar o nome <em>dataframe</em> para se referir a um <code>tibble</code>. Veja o exemplo a seguir, onde criamos uma tabela correspondente a dados financeiros de diferentes ações.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set tickers</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ticker <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'ABEV3'</span>,<span class="dv">4</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="st">'BBAS3'</span>, <span class="dv">4</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="st">'BBDC3'</span>, <span class="dv">4</span>))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set dates</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>ref_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'2010-01-01'</span>, <span class="st">'2010-01-04'</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'2010-01-05'</span>, <span class="st">'2010-01-06'</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">3</span>) )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># set prices</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">736.67</span>, <span class="fl">764.14</span>, <span class="fl">768.63</span>, <span class="fl">776.47</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>           <span class="fl">59.4</span>  , <span class="fl">59.8</span>  , <span class="fl">59.2</span>  , <span class="fl">59.28</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>           <span class="fl">29.81</span> , <span class="fl">30.82</span> , <span class="fl">30.38</span> , <span class="fl">30.20</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create tibble/dataframe</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(ticker, ref_date , price)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># print it</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 12 × 3
R&gt;    ticker ref_date   price
R&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;
R&gt;  1 ABEV3  2010-01-01 737. 
R&gt;  2 ABEV3  2010-01-04 764. 
R&gt;  3 ABEV3  2010-01-05 769. 
R&gt;  4 ABEV3  2010-01-06 776. 
R&gt;  5 BBAS3  2010-01-01  59.4
R&gt;  6 BBAS3  2010-01-04  59.8
R&gt;  7 BBAS3  2010-01-05  59.2
R&gt;  8 BBAS3  2010-01-06  59.3
R&gt;  9 BBDC3  2010-01-01  29.8
R&gt; 10 BBDC3  2010-01-04  30.8
R&gt; 11 BBDC3  2010-01-05  30.4
R&gt; 12 BBDC3  2010-01-06  30.2</code></pre>
</div>
</div>
<p>Observe que utilizamos a função <strong>rep()</strong> para replicar e facilitar a criação dos dados do <code>dataframe</code> anterior. Assim, não é necessário repetir os valores múltiplas vezes. Destaca-se que, no uso dos <code>dataframes</code>, podemos salvar todos os nossos dados em um único objeto, facilitando o acesso e a organização do código resultante.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dica
</div>
</div>
<div class="callout-body-container callout-body">
<p>O conteúdo de <code>dataframes</code> também pode ser visualizado no próprio RStudio. Para isso, basta clicar no nome do objeto na aba <em>environment</em>, canto superior direito da tela. Após isso, um visualizador aparecerá na tela principal do programa. Essa operação é nada mais que uma chamada a função <strong>View()</strong> . Portanto, poderíamos visualizar o <code>dataframe</code> anterior executando o comando <code>View(my_df)</code>.</p>
</div>
</div>
</section>
<section id="inspecionando-um-dataframe" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="inspecionando-um-dataframe"><span class="header-section-number">8.1.2</span> Inspecionando um <code>dataframe</code></h3>
<p>Após a criação do <code>dataframe</code>, o segundo passo é conhecer o seu conteúdo. Particularmente, é importante tomar conhecimento dos seguintes itens em ordem de importância:</p>
<dl>
<dt>Número de linhas e colunas</dt>
<dd>
O número de linhas e colunas da tabela resultante indicam se a operação de importação foi executada corretamente. Caso os valores forem diferentes do esperado, deve-se checar o arquivo de importação dos dados e se as opções de importação fazem sentido para o arquivo.
</dd>
<dt>Nomes das colunas</dt>
<dd>
É importante que a tabela importada tenha nomes que façam sentido e que sejam fáceis de acessar. Portanto, o segundo passo na inspeção de um <code>dataframe</code> é analisar os nomes das colunas e seus respectivos conteúdos. Confirme que cada coluna realmente apresenta um nome intuitivo e relacionado ao problema.
</dd>
<dt>Classes das colunas</dt>
<dd>
Cada coluna de um <code>dataframe</code> tem sua própria classe. É de suma importância que as classes dos dados estejam corretamente especificadas. Caso contrário, operações futuras podem resultar em um erro. Por exemplo, caso um vetor de valores numéricos seja importado com a classe de texto (<code>character</code>), qualquer operação matemática nesse vetor irá resultar em um erro no R.
</dd>
<dt>Existência de dados omissos (<code>NA</code>)</dt>
<dd>
Devemos também verificar o número de valores <code>NA</code> (<em>not available</em>) nas diferentes colunas. Sempre que você encontrar uma grande proporção de valores <code>NA</code> na tabela importada, você deve descobrir o que está acontecendo e se a informação está sendo importada corretamente. Conforme mencionado no capítulo anterior, os valores <code>NA</code> são contagiosos e transformarão qualquer objeto que interagir com um <code>NA</code>, também se tornará um <code>NA</code>.
</dd>
</dl>
<p>Uma das funções mais recomendadas para se familiarizar com um <code>dataframe</code> é <strong>dplyr</strong>::<strong>glimpse()</strong> . Essa mostra na tela o nome e a classe das colunas, além do número de linhas/colunas. Abusamos dessa função nos capítulos anteriores. Veja um exemplo simples a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check content of my_df</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 12
R&gt; Columns: 3
R&gt; $ ticker   &lt;chr&gt; "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS…
R&gt; $ ref_date &lt;date&gt; 2010-01-01, 2010-01-04, 2010-01-05, 2010…
R&gt; $ price    &lt;dbl&gt; 736.67, 764.14, 768.63, 776.47, 59.40, 59…</code></pre>
</div>
</div>
<p>Em muitas situações, o uso de <strong>dplyr</strong>::<strong>glimpse()</strong> é suficiente para entender se o processo de importação de dados ocorreu de forma satisfatória. Porém, uma análise mais profunda é entender qual a variação de cada coluna nos dados importados. Aqui entra o papel da função <strong>summary()</strong> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check variation my_df</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;     ticker             ref_date              price       
R&gt;  Length:12          Min.   :2010-01-01   Min.   : 29.81  
R&gt;  Class :character   1st Qu.:2010-01-03   1st Qu.: 30.71  
R&gt;  Mode  :character   Median :2010-01-04   Median : 59.34  
R&gt;                     Mean   :2010-01-04   Mean   :283.73  
R&gt;                     3rd Qu.:2010-01-05   3rd Qu.:743.54  
R&gt;                     Max.   :2010-01-06   Max.   :776.47</code></pre>
</div>
</div>
<p>Note que <strong>summary()</strong> interpreta cada coluna de forma diferente. Para o primeiro caso, coluna <code>ticker</code>, mostra apenas o tamanho do vetor. No caso de datas e valores numéricos, essa apresenta o máximo, mínimo, mediana e quartis. Por exemplo, uma observação extrema (<em>outlier</em>) poderia ser facilmente identificada na análise da saída textual de <strong>summary()</strong> .</p>
<p>Uma alternativa moderna para <strong>summary()</strong> é <strong>skimr</strong>::<strong>skim()</strong> , que fornece mais detalhes sobre os dados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check content of my_df</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você não só obtém as classes das colunas, mas também mais informações sobre as diferentes classes de dados:</p>
<ul>
<li>Para a coluna <code>tickers</code>, você obtém o número de casos ausentes, valores únicos e mais;</li>
<li>Para a coluna <code>dates</code>, você obtém o mínimo e o máximo de dados, bem como o número de datas disponíveis;</li>
<li>Para colunas de valores numéricos, você obtém média, desvio padrão e quantis e mais;</li>
</ul>
<p>Embora não seja suficiente, uma simples chamada a <strong>skimr</strong>::<strong>skim()</strong> pode fornecer uma grande quantidade de informações sobre os dados sendo importados.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dica
</div>
</div>
<div class="callout-body-container callout-body">
<p>Toda vez que se deparar com um novo <code>dataframe</code> no R, pegue o hábito de verificar o seu conteúdo com funções <strong>dplyr</strong>::<strong>glimpse()</strong> e <strong>skimr</strong>::<strong>skim()</strong> . Assim, poderá perceber problemas de importação e/ou conteúdo dos arquivos lidos. Com experiência irás perceber que muitos erros futuros em código podem ser sanados por uma simples inspeção das tabelas importadas.</p>
</div>
</div>
</section>
<section id="operador-de-pipeline" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="operador-de-pipeline"><span class="header-section-number">8.1.3</span> Operador de <em>pipeline</em></h3>
<p>O operador de <em>pipeline</em> (ou sequenciamento, em tradução livre) é uma ferramenta fundamental na análise de dados com R. Resumidamente, ele permite que operações de dados sejam realizadas sequencialmente e de forma modular, aumentando a legibilidade e a facilidade de manutenção do código resultante. O operador é amplamente utilizado no pacote <strong>{tidyverse}</strong> <span class="citation" data-cites="R-tidyverse">(<a href="99-references.html#ref-R-tidyverse" role="doc-biblioref">Wickham 2023</a>)</span> e foi proposto pela primeira vez no pacote r cite_pkg(“magrittr”) com o símbolo <code>%&gt;%</code>. Recentemente, na versão 4.1 do <a href="https://cran.r-project.org/doc/manuals/r-devel/NEWS.html">R</a>, lançada em 18 de maio de 2021, um novo operador pipe (nativo) foi introduzido (<code>|&gt;</code>), facilitando seu uso por todos.</p>
<p>Para explicar melhor, imagine uma situação onde temos três funções para aplicar nos dados salvos em um <code>dataframe</code>. Cada função depende da saída de outra função. Isso requer o encadeamento de suas chamadas. Usando o operador de <em>pipeline</em>, podemos escrever o procedimento de manipulação <code>dataframe</code> com o seguinte código:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>my_tab <span class="ot">&lt;-</span> my_df <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fct1</span>(arg1) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fct2</span>(arg2) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fct3</span>(arg3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Usamos símbolo <code>|&gt;</code> no final de cada linha para vincular as operações. As funções <code>fct*</code> são operações realizadas em cada etapa. O resultado de cada linha é passado para a próxima função de forma sequencial. Assim, não há necessidade de criar objetos intermediários. Veja a seguir duas formas alternativas de realizar a mesma operação sem o operador de <em>pipeline</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># version 1</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>my_tab <span class="ot">&lt;-</span> <span class="fu">fct3</span>(<span class="fu">fct2</span>(<span class="fu">fct1</span>(my_df,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                         arg1),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                    arg2),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>               arg1)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># version 2</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>temp1 <span class="ot">&lt;-</span> <span class="fu">fct1</span>(my_df, arg1)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> <span class="fu">fct2</span>(temp1, arg2)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>my_tab <span class="ot">&lt;-</span> <span class="fu">fct3</span>(temp1, arg3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observe como as alternativas formam um código com estrutura estranha e passível a erros. Provavelmente não deves ter notado, mas ambos os códigos possuem erros de digitação. Para o primeiro, o último <code>arg1</code> deveria ser <code>arg3</code> e, no segundo, a função <code>fct3</code> está usando o <code>dataframe</code> <code>temp1</code> e não <code>temp2</code>. Este exemplo deixa claro como o uso de <em>pipelines</em> torna o código mais elegante e legível. A partir de agora iremos utilizar o operador <code>|&gt;</code> de forma extensiva.</p>
</section>
<section id="acessando-colunas" class="level3" data-number="8.1.4">
<h3 data-number="8.1.4" class="anchored" data-anchor-id="acessando-colunas"><span class="header-section-number">8.1.4</span> Acessando Colunas</h3>
<p>Um objeto do tipo <code>dataframe</code> utiliza-se de diversos comandos e símbolos que também são usados em matrizes e listas. Para descobrir os nomes das colunas de um <code>dataframe</code>, temos duas funções: <strong>names()</strong> ou <strong>colnames()</strong> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check names of df</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "ticker"   "ref_date" "price"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "ticker"   "ref_date" "price"</code></pre>
</div>
</div>
<p>Ambas também podem ser usadas para modificar os nomes das colunas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set temp df</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>temp_df <span class="ot">&lt;-</span> my_df</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check names</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "ticker"   "ref_date" "price"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change names</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp_df) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">'Col'</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(temp_df))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check names</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "Col1" "Col2" "Col3"</code></pre>
</div>
</div>
<p>Destaca-se que a forma de usar <strong>names()</strong> é bastante distinta das demais funções do R. Nesse caso, utilizamos a função ao lado esquerdo do símbolo de <code>assign</code> (<code>&lt;-</code>). Internamente, o que estamos fazendo é definindo um atributo do objeto <code>temp_df</code>, o nome de suas colunas.</p>
<p>Para acessar uma determinada coluna, podemos utilizar o nome da mesma de diversas formas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># isolate columns of df</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>my_ticker <span class="ot">&lt;-</span> my_df<span class="sc">$</span>ticker</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>my_prices <span class="ot">&lt;-</span> my_df[[<span class="st">'price'</span>]]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print contents</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_ticker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;  [1] "ABEV3" "ABEV3" "ABEV3" "ABEV3" "BBAS3" "BBAS3" "BBAS3"
R&gt;  [8] "BBAS3" "BBDC3" "BBDC3" "BBDC3" "BBDC3"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_prices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;  [1] 736.67 764.14 768.63 776.47  59.40  59.80  59.20  59.28
R&gt;  [9]  29.81  30.82  30.38  30.20</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cuidado!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Toda vez que estiver acessando colunas de um <code>dataframe</code>, o resultado é um vetor atômico com os dados da coluna. Isso é importante saber pois as propriedades do objeto se modificam.</p>
</div>
</div>
<p>Note o uso do duplo colchetes (<code>[[]]</code>) para selecionar colunas. Vale apontar que, no R, <strong>um objeto da classe <code>dataframe</code> é representado internamente como uma lista</strong>, onde cada elemento é uma coluna. Isso é importante saber, pois alguns comandos de listas também funcionam para <code>dataframes</code>. Um exemplo é o uso de duplo colchetes (<code>[[]]</code>) para selecionar colunas por posição:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;  [1] "2010-01-01" "2010-01-04" "2010-01-05" "2010-01-06"
R&gt;  [5] "2010-01-01" "2010-01-04" "2010-01-05" "2010-01-06"
R&gt;  [9] "2010-01-01" "2010-01-04" "2010-01-05" "2010-01-06"</code></pre>
</div>
</div>
<p>Para acessar linhas e colunas específicas de um <code>dataframe</code>, basta utilizar colchetes simples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 1
R&gt;   ref_date  
R&gt;   &lt;date&gt;    
R&gt; 1 2010-01-01
R&gt; 2 2010-01-04
R&gt; 3 2010-01-05
R&gt; 4 2010-01-06
R&gt; 5 2010-01-01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;   ticker ref_date  
R&gt;   &lt;chr&gt;  &lt;date&gt;    
R&gt; 1 ABEV3  2010-01-01
R&gt; 2 ABEV3  2010-01-04
R&gt; 3 ABEV3  2010-01-05
R&gt; 4 ABEV3  2010-01-06
R&gt; 5 BBAS3  2010-01-01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 3
R&gt;   ticker ref_date   price
R&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;
R&gt; 1 ABEV3  2010-01-01 737. 
R&gt; 2 ABEV3  2010-01-04 764. 
R&gt; 3 ABEV3  2010-01-05 769. 
R&gt; 4 ABEV3  2010-01-06 776. 
R&gt; 5 BBAS3  2010-01-01  59.4</code></pre>
</div>
</div>
<p>Essa seleção de colunas também pode ser realizada utilizando o nome das mesmas da seguinte forma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="st">'ticker'</span>,<span class="st">'price'</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 3 × 2
R&gt;   ticker price
R&gt;   &lt;chr&gt;  &lt;dbl&gt;
R&gt; 1 ABEV3   737.
R&gt; 2 ABEV3   764.
R&gt; 3 ABEV3   769.</code></pre>
</div>
</div>
<p>ou, pelo operador de <em>pipeline</em> e a função <strong>dplyr</strong>::<strong>select()</strong> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>my.temp <span class="ot">&lt;-</span> my_df <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ticker, price) <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 12
R&gt; Columns: 2
R&gt; $ ticker &lt;chr&gt; "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS3"…
R&gt; $ price  &lt;dbl&gt; 736.67, 764.14, 768.63, 776.47, 59.40, 59.8…</code></pre>
</div>
</div>
</section>
<section id="modificando-um-dataframe" class="level3" data-number="8.1.5">
<h3 data-number="8.1.5" class="anchored" data-anchor-id="modificando-um-dataframe"><span class="header-section-number">8.1.5</span> Modificando um <code>dataframe</code></h3>
<p>Para criar novas colunas em um <code>dataframe</code>, basta utilizar a função <strong>dplyr</strong>::<strong>mutate()</strong> . Aqui iremos abusar do operador de <em>pipeline</em> (<code>|&gt;</code>) para sequenciar as operações:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add columns with mutate</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> my_df <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ret =</span> price<span class="sc">/</span><span class="fu">lag</span>(price) <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">my_seq1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(my_df),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">my_seq2 =</span>  my_seq1 <span class="sc">+</span><span class="dv">9</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 12
R&gt; Columns: 6
R&gt; $ ticker   &lt;chr&gt; "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS…
R&gt; $ ref_date &lt;date&gt; 2010-01-01, 2010-01-04, 2010-01-05, 2010…
R&gt; $ price    &lt;dbl&gt; 736.67, 764.14, 768.63, 776.47, 59.40, 59…
R&gt; $ ret      &lt;dbl&gt; NA, 0.037289424, 0.005875887, 0.010199966…
R&gt; $ my_seq1  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
R&gt; $ my_seq2  &lt;dbl&gt; 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2…</code></pre>
</div>
</div>
<p>Note que precisamos indicar o <code>dataframe</code> de origem dos dados, nesse caso o objeto <code>my_df</code>, e as colunas são definidas como argumentos em <strong>dplyr</strong>::<strong>mutate()</strong> . Observe também que usamos a coluna <code>price</code> na construção de <code>ret</code>, o retorno aritmético dos preços. Um caso especial é a construção de <code>my_seq2</code> com base em <code>my_seq1</code>, isto é, antes mesmo dela ser explicitamente calculada já é possível utilizar a nova coluna para criar outra. Vale salientar que a nova coluna deve ter exatamente o mesmo número de elementos que as demais. Caso contrário, o R retorna uma mensagem de erro.</p>
<p>A maneira mais tradicional, e comumente encontrada em código, para criar novas colunas é utilizar o símbolo <code>$</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add new column with base R</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>my_df<span class="sc">$</span>my_seq3 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(my_df)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check it</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 12
R&gt; Columns: 7
R&gt; $ ticker   &lt;chr&gt; "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS…
R&gt; $ ref_date &lt;date&gt; 2010-01-01, 2010-01-04, 2010-01-05, 2010…
R&gt; $ price    &lt;dbl&gt; 736.67, 764.14, 768.63, 776.47, 59.40, 59…
R&gt; $ ret      &lt;dbl&gt; NA, 0.037289424, 0.005875887, 0.010199966…
R&gt; $ my_seq1  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
R&gt; $ my_seq2  &lt;dbl&gt; 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2…
R&gt; $ my_seq3  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12</code></pre>
</div>
</div>
<p>Portanto, o operador <code>$</code> vale tanto para acessar quanto para criar novas colunas.</p>
<p>Para remover colunas de um <code>dataframe</code>, basta usar <strong>dplyr</strong>::<strong>select()</strong> com operador negativo para o nome das colunas indesejadas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># removing columns</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>my_df_temp <span class="ot">&lt;-</span> my_df <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>my_seq1, <span class="sc">-</span>my_seq2, <span class="sc">-</span>my_seq3) <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 12
R&gt; Columns: 4
R&gt; $ ticker   &lt;chr&gt; "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS…
R&gt; $ ref_date &lt;date&gt; 2010-01-01, 2010-01-04, 2010-01-05, 2010…
R&gt; $ price    &lt;dbl&gt; 736.67, 764.14, 768.63, 776.47, 59.40, 59…
R&gt; $ ret      &lt;dbl&gt; NA, 0.037289424, 0.005875887, 0.010199966…</code></pre>
</div>
</div>
<p>No uso de funções nativas do R, a maneira tradicional de remover colunas é alocar o valor nulo (<code>NULL</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set temp df</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>temp_df <span class="ot">&lt;-</span> my_df</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># remove cols</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>temp_df<span class="sc">$</span>price <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>temp_df<span class="sc">$</span>ref_date  <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># check it</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(temp_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 12
R&gt; Columns: 5
R&gt; $ ticker  &lt;chr&gt; "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS3…
R&gt; $ ret     &lt;dbl&gt; NA, 0.037289424, 0.005875887, 0.010199966,…
R&gt; $ my_seq1 &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
R&gt; $ my_seq2 &lt;dbl&gt; 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20…
R&gt; $ my_seq3 &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12</code></pre>
</div>
</div>
</section>
<section id="filtrando-um-dataframe" class="level3" data-number="8.1.6">
<h3 data-number="8.1.6" class="anchored" data-anchor-id="filtrando-um-dataframe"><span class="header-section-number">8.1.6</span> Filtrando um <code>dataframe</code></h3>
<p>Uma operação bastante comum no R é filtrar linhas de uma tabela de acordo com uma ou mais condições. Por exemplo, caso quiséssemos apenas os dados da ação <code>ABEV3</code>, poderíamos utilizar a função <strong>dplyr</strong>::<strong>filter()</strong> para filtrar a tabela:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># filter df for single stock</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>my_df_temp <span class="ot">&lt;-</span> my_df <span class="sc">|&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ticker <span class="sc">==</span> <span class="st">'ABEV3'</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 4
R&gt; Columns: 7
R&gt; $ ticker   &lt;chr&gt; "ABEV3", "ABEV3", "ABEV3", "ABEV3"
R&gt; $ ref_date &lt;date&gt; 2010-01-01, 2010-01-04, 2010-01-05, 2010-…
R&gt; $ price    &lt;dbl&gt; 736.67, 764.14, 768.63, 776.47
R&gt; $ ret      &lt;dbl&gt; NA, 0.037289424, 0.005875887, 0.010199966
R&gt; $ my_seq1  &lt;int&gt; 1, 2, 3, 4
R&gt; $ my_seq2  &lt;dbl&gt; 10, 11, 12, 13
R&gt; $ my_seq3  &lt;int&gt; 1, 2, 3, 4</code></pre>
</div>
</div>
<p>A função também aceita mais de uma condição. Veja a seguir onde filtramos os dados para <code>'ABEV3'</code> em datas após ou igual a <code>'2010-01-05'</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter df for single stock and date</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>my_df_temp <span class="ot">&lt;-</span> my_df <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ticker <span class="sc">==</span> <span class="st">'ABEV3'</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>         ref_date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">'2010-01-05'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 2
R&gt; Columns: 7
R&gt; $ ticker   &lt;chr&gt; "ABEV3", "ABEV3"
R&gt; $ ref_date &lt;date&gt; 2010-01-05, 2010-01-06
R&gt; $ price    &lt;dbl&gt; 768.63, 776.47
R&gt; $ ret      &lt;dbl&gt; 0.005875887, 0.010199966
R&gt; $ my_seq1  &lt;int&gt; 3, 4
R&gt; $ my_seq2  &lt;dbl&gt; 12, 13
R&gt; $ my_seq3  &lt;int&gt; 3, 4</code></pre>
</div>
</div>
<p>Aqui utilizamos o símbolo <code>==</code> para testar uma igualdade. Iremos estudar mais profundamente a classe de testes lógicos no capítulo <a href="09-objetos-basicos.html"><span>Chapter&nbsp;9</span></a>.</p>
</section>
<section id="ordenando-um-dataframe" class="level3" data-number="8.1.7">
<h3 data-number="8.1.7" class="anchored" data-anchor-id="ordenando-um-dataframe"><span class="header-section-number">8.1.7</span> Ordenando um <code>dataframe</code></h3>
<p>Após a criação ou importação de um <code>dataframe</code>, pode-se ordenar seus componentes de acordo com os valores de alguma coluna. Um caso bastante comum em que é necessário realizar uma ordenação explícita é quando importamos dados financeiros em que as datas não estão em ordem crescente. Na grande maioria das situações, dados temporais devem estar ordenados de acordo com a antiguidade, isto é, dados mais recentes são alocados na última linha da tabela. Essa operação é realizada através do uso da função <strong>order()</strong> ou <strong>dplyr</strong>::<strong>arrange()</strong> .</p>
<p>Como exemplo, considere a criação de um <code>dataframe</code> com os valores a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set df</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">col1 =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">col2 =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">col3 =</span> <span class="fu">c</span>(<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>))</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print it</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     4     1 a    
R&gt; 2     1     1 b    
R&gt; 3     2     3 c</code></pre>
</div>
</div>
<p>A função <strong>order()</strong> retorna os índices relativos à ordenação dos valores dados como entrada. Para o caso da primeira coluna de <code>my_df</code>, os índices dos elementos formadores do novo vetor, com seus valores ordenados em forma crescente, são:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">order</span>(my_df<span class="sc">$</span>col1)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(idx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 2 3 1</code></pre>
</div>
</div>
<p>Portanto, ao utilizar a saída da função <strong>order()</strong> como indexador do <code>dataframe</code>, acaba-se ordenando o mesmo de acordo com os valores da coluna <code>col1</code>. Veja a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>my_df_2 <span class="ot">&lt;-</span> my_df[<span class="fu">order</span>(my_df<span class="sc">$</span>col1), ]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1     1 b    
R&gt; 2     2     3 c    
R&gt; 3     4     1 a</code></pre>
</div>
</div>
<p>Essa operação de ordenamento também pode ser realizada levando em conta mais de uma coluna. Veja o exemplo a seguir, onde se ordena o <code>dataframe</code> pelas colunas <code>col2</code> e <code>col1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">order</span>(my_df<span class="sc">$</span>col2, my_df<span class="sc">$</span>col1)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>my_df_3 <span class="ot">&lt;-</span> my_df[idx, ]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1     1 b    
R&gt; 2     4     1 a    
R&gt; 3     2     3 c</code></pre>
</div>
</div>
<p>No <strong>{tidyverse}</strong> <span class="citation" data-cites="R-tidyverse">(<a href="99-references.html#ref-R-tidyverse" role="doc-biblioref">Wickham 2023</a>)</span>, a forma de ordenar <code>dataframes</code> é pelo uso da função <strong>dplyr</strong>::<strong>arrange()</strong> . No caso de ordenamento decrescente, encapsulamos o nome das colunas com <code>desc</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort ascending, by col1 and col2</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> my_df <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(col1, col2) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1     1 b    
R&gt; 2     2     3 c    
R&gt; 3     4     1 a</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort descending, col1 and col2</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> my_df <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(col1), <span class="fu">desc</span>(col2)) <span class="sc">|&gt;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     4     1 a    
R&gt; 2     2     3 c    
R&gt; 3     1     1 b</code></pre>
</div>
</div>
<p>O resultado prático no uso de <strong>dplyr</strong>::<strong>arrange()</strong> é o mesmo de <strong>order()</strong> . Um dos seus benefícios é a possibilidade de encadeamento de operações através do uso do <em>pipeline</em>.</p>
</section>
<section id="combinando-e-agregando-dataframes" class="level3" data-number="8.1.8">
<h3 data-number="8.1.8" class="anchored" data-anchor-id="combinando-e-agregando-dataframes"><span class="header-section-number">8.1.8</span> Combinando e Agregando <code>dataframes</code></h3>
<p>Em muitas situações de análise de dados será necessário juntar <code>dataframes</code> distintos em um único objeto. Tabelas diferentes são importadas no R e, antes de analisar os dados, precisamos combinar as informações em um único objeto. Nos casos mais simples, onde as tabelas a serem agregadas possuem o mesmo formato, nós as juntamos de acordo com as linhas, verticalmente, ou colunas, horizontalmente. Para esse fim, temos as funções <strong>dplyr</strong>::<strong>bind_rows()</strong> e <strong>dplyr</strong>::<strong>bind_cols()</strong> no tidyverse e <strong>rbind()</strong> e <strong>cbind()</strong> nas funções nativas do R. Observe o exemplo a seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set dfs</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>my_df_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">col1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col2 =</span> <span class="fu">rep</span>(<span class="st">'a'</span>, <span class="dv">5</span>))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>my_df_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">col1 =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col2 =</span> <span class="fu">rep</span>(<span class="st">'b'</span>, <span class="dv">5</span>),</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col3 =</span> <span class="fu">rep</span>(<span class="st">'c'</span>, <span class="dv">5</span>))</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co"># bind by row</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(my_df_1, my_df_2) <span class="sc">|&gt;</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 10
R&gt; Columns: 3
R&gt; $ col1 &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
R&gt; $ col2 &lt;chr&gt; "a", "a", "a", "a", "a", "b", "b", "b", "b", …
R&gt; $ col3 &lt;chr&gt; NA, NA, NA, NA, NA, "c", "c", "c", "c", "c"</code></pre>
</div>
</div>
<p>Note que, no exemplo anterior, os nomes das colunas são os mesmos. De fato, a função <strong>dplyr</strong>::<strong>bind_rows()</strong> procura os nomes iguais em ambos os objetos para fazer a junção dos <code>dataframes</code> corretamente. As colunas que não ocorrem em ambos objetos, tal como <code>col3</code> no exemplo, saem como <code>NA</code> no objeto final. Já para o caso de <strong>dplyr</strong>::<strong>bind_cols()</strong> , os nomes das colunas devem ser diferentes, porém o número de linhas deve ser o mesmo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set dfs</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>my_df_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">col1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">col2 =</span> <span class="fu">rep</span>(<span class="st">'a'</span>, <span class="dv">5</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>my_df_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">col3 =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">col4 =</span> <span class="fu">rep</span>(<span class="st">'b'</span>, <span class="dv">5</span>))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bind by column</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(my_df_1, my_df_2) <span class="sc">|&gt;</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 5
R&gt; Columns: 4
R&gt; $ col1 &lt;int&gt; 1, 2, 3, 4, 5
R&gt; $ col2 &lt;chr&gt; "a", "a", "a", "a", "a"
R&gt; $ col3 &lt;int&gt; 6, 7, 8, 9, 10
R&gt; $ col4 &lt;chr&gt; "b", "b", "b", "b", "b"</code></pre>
</div>
</div>
<p>Para casos mais complexos, onde a junção deve ser realizada de acordo com algum índice tal como uma data, é possível juntar <code>dataframes</code> diferentes com o uso das funções da família <code>dplyr::join*</code> tal como <strong>dplyr</strong>::<strong>inner_join()</strong> , <strong>dplyr</strong>::<strong>left_join()</strong> , <strong>dplyr</strong>::<strong>right_join()</strong> , entre outras. A descrição de todas elas não cabe aqui. Iremos descrever apenas o caso mais provável, <strong>dplyr</strong>::<strong>inner_join()</strong> . Essa combina os dados, mantendo apenas os casos onde existe o índice em ambos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set df</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>my_df_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="st">'2016-01-01'</span>)<span class="sc">+</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>my_df_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="st">'2016-01-05'</span>)<span class="sc">+</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">30</span>, <span class="at">length.out =</span> <span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note que os <code>dataframes</code> criados possuem uma coluna em comum, <code>date</code>. A partir desta coluna que agregamos as tabelas com <strong>dplyr</strong>::<strong>inner_join()</strong> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate tables</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(my_df_1, my_df_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>R&gt; Joining with `by = join_by(date)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 7
R&gt; Columns: 3
R&gt; $ date &lt;date&gt; 2016-01-05, 2016-01-06, 2016-01-07, 2016-01-…
R&gt; $ x    &lt;int&gt; 5, 6, 7, 8, 9, 10, 11
R&gt; $ y    &lt;dbl&gt; 20, 21, 22, 23, 24, 25, 26</code></pre>
</div>
</div>
<p>O R automaticamente verifica a existência de colunas com mesmo nome nos <code>dataframes</code> e realiza a junção por essas. Caso quiséssemos juntar <code>dataframes</code> onde os nomes das colunas para utilizar o índice não são iguais, temos duas soluções: modificar os nomes das colunas ou então utilizar argumento <code>by</code> em <strong>dplyr</strong>::<strong>inner_join()</strong> . Veja a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set df</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>my_df_3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">ref_date =</span> <span class="fu">as.Date</span>(<span class="st">'2016-01-01'</span>)<span class="sc">+</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>my_df_4 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">my_date =</span> <span class="fu">as.Date</span>(<span class="st">'2016-01-05'</span>)<span class="sc">+</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">30</span>, <span class="at">length.out =</span> <span class="dv">11</span>))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># join by my_df_3$ref_date and my_df_4$my_date</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(my_df_3, my_df_4,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'ref_date'</span> <span class="ot">=</span> <span class="st">'my_date'</span>))</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 7
R&gt; Columns: 3
R&gt; $ ref_date &lt;date&gt; 2016-01-05, 2016-01-06, 2016-01-07, 2016…
R&gt; $ x        &lt;int&gt; 5, 6, 7, 8, 9, 10, 11
R&gt; $ y        &lt;dbl&gt; 20, 21, 22, 23, 24, 25, 26</code></pre>
</div>
</div>
<p>Para o caso de uso da função nativa de agregação de <code>dataframes</code>, <strong>merge()</strong> , temos que indicar explicitamente o nome da coluna com argumento <code>by</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregation with base R</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(my_df_1, my_df_2, <span class="at">by =</span> <span class="st">'date'</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; Rows: 7
R&gt; Columns: 3
R&gt; $ date &lt;date&gt; 2016-01-05, 2016-01-06, 2016-01-07, 2016-01-…
R&gt; $ x    &lt;int&gt; 5, 6, 7, 8, 9, 10, 11
R&gt; $ y    &lt;dbl&gt; 20, 21, 22, 23, 24, 25, 26</code></pre>
</div>
</div>
<p>Note que, nesse caso, o <code>dataframe</code> resultante manteve apenas as informações compartilhadas entre ambos os objetos, isto é, aquelas linhas onde as datas em <code>date</code> eram iguais. Esse é o mesmo resultado quando no uso do <strong>dplyr</strong>::<strong>inner_join()</strong> .</p>
<p>As demais funções de agregação de tabelas – <strong>dplyr</strong>::<strong>left_join()</strong> , <strong>dplyr</strong>::<strong>right_join()</strong> e <strong>dplyr</strong>::<strong>full_join()</strong> – funcionam de forma muito semelhante a <strong>dplyr</strong>::<strong>inner_join()</strong> , exceto na escolha da saída. Por exemplo, <strong>dplyr</strong>::<strong>full_join()</strong> retorna todos os casos/linhas entre tabela 1 e 2, incluindo aqueles onde não tem o índice compartilhado. Para estes casos, a coluna do índice sairá como <code>NA</code>. Veja o exemplo a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set df</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>my_df_5 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">ref_date =</span> <span class="fu">as.Date</span>(<span class="st">'2016-01-01'</span>)<span class="sc">+</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>my_df_6 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">ref_date =</span> <span class="fu">as.Date</span>(<span class="st">'2016-01-05'</span>)<span class="sc">+</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">30</span>, <span class="at">length.out =</span> <span class="dv">11</span>))</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co"># combine with full_join</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">full_join</span>(my_df_5, my_df_6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>R&gt; Joining with `by = join_by(ref_date)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print it</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 15 × 3
R&gt;    ref_date       x     y
R&gt;    &lt;date&gt;     &lt;int&gt; &lt;dbl&gt;
R&gt;  1 2016-01-01     1    NA
R&gt;  2 2016-01-02     2    NA
R&gt;  3 2016-01-03     3    NA
R&gt;  4 2016-01-04     4    NA
R&gt;  5 2016-01-05     5    20
R&gt;  6 2016-01-06     6    21
R&gt;  7 2016-01-07     7    22
R&gt;  8 2016-01-08     8    23
R&gt;  9 2016-01-09     9    24
R&gt; 10 2016-01-10    10    25
R&gt; 11 2016-01-11    11    26
R&gt; 12 2016-01-12    NA    27
R&gt; 13 2016-01-13    NA    28
R&gt; 14 2016-01-14    NA    29
R&gt; 15 2016-01-15    NA    30</code></pre>
</div>
</div>
</section>
<section id="extensões-ao-dataframe" class="level3" data-number="8.1.9">
<h3 data-number="8.1.9" class="anchored" data-anchor-id="extensões-ao-dataframe"><span class="header-section-number">8.1.9</span> Extensões ao <code>dataframe</code></h3>
<p>Como já foi relatado nos capítulos anteriores, um dos grandes benefícios no uso do R é a existência de pacotes para lidar com os problemas específicos dos usuários. Enquanto um objeto tabular do tipo <code>tibble</code> é suficiente para a maioria dos casos, existem benefícios no uso de uma classe alternativa. Ao longo do tempo, diversas soluções foram disponibilizadas por desenvolvedores.</p>
<p>Por exemplo, é muito comum trabalharmos com dados exclusivamente numéricos que são indexados ao tempo. Isto é, situações onde cada informação pertence a um índice temporal - um objeto da classe data/tempo. As linhas dessa tabela representam um ponto no tempo, enquanto as colunas indicam variáveis numéricas de interesse. Nesse caso, faria sentido representarmos os nossos dados como objetos do tipo <strong>{xts}</strong> <span class="citation" data-cites="R-xts">(<a href="99-references.html#ref-R-xts" role="doc-biblioref"><strong>R-xts?</strong></a>)</span>. O grande benefício dessa opção é que a agregação e a manipulação de variáveis em função do tempo é muito fácil. Por exemplo, podemos transformar dados de frequência diária para a frequência semanal com apenas uma linha de comando. Além disso, diversas outras funções reconhecem automaticamente que os dados são indexados ao tempo. Um exemplo é a criação de uma figura com esses dados. Nesse caso, o eixo horizontal da figura é automaticamente organizado com as datas.</p>
<p>Veja um caso a seguir, onde carregamos os dados anteriores como um objeto <strong>{xts}</strong> <span class="citation" data-cites="R-xts">(<a href="99-references.html#ref-R-xts" role="doc-biblioref"><strong>R-xts?</strong></a>)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>R&gt; Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>R&gt; 
R&gt; Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>R&gt; The following objects are masked from 'package:base':
R&gt; 
R&gt;     as.Date, as.Date.numeric</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>R&gt; 
R&gt; ######################### Warning from 'xts' package ##########################
R&gt; #                                                                             #
R&gt; # The dplyr lag() function breaks how base R's lag() function is supposed to  #
R&gt; # work, which breaks lag(my_xts). Calls to lag(my_xts) that you type or       #
R&gt; # source() into this session won't work correctly.                            #
R&gt; #                                                                             #
R&gt; # Use stats::lag() to make sure you're not using dplyr::lag(), or you can add #
R&gt; # conflictRules('dplyr', exclude = 'lag') to your .Rprofile to stop           #
R&gt; # dplyr from breaking base R's lag() function.                                #
R&gt; #                                                                             #
R&gt; # Code in packages is not affected. It's protected by R's namespace mechanism #
R&gt; # Set `options(xts.warn_dplyr_breaks_lag = FALSE)` to suppress this warning.  #
R&gt; #                                                                             #
R&gt; ###############################################################################</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>R&gt; 
R&gt; Attaching package: 'xts'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>R&gt; The following objects are masked from 'package:dplyr':
R&gt; 
R&gt;     first, last</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set data</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>ticker <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'ABEV3'</span>, <span class="st">'BBAS3'</span>,<span class="st">'BBDC3'</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">'2010-01-01'</span>, <span class="st">'2010-01-04'</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'2010-01-05'</span>, <span class="st">'2010-01-06'</span>))</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>price_ABEV3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">736.67</span>, <span class="fl">764.14</span>, <span class="fl">768.63</span>, <span class="fl">776.47</span>)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>price_BBAS3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">59.4</span>, <span class="fl">59.8</span>, <span class="fl">59.2</span>, <span class="fl">59.28</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>price_BBDC3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">29.81</span>, <span class="fl">30.82</span>, <span class="fl">30.38</span>, <span class="fl">30.20</span>)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># build matrix</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>my_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(price_BBDC3, price_BBAS3, price_ABEV3),</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nrow =</span> <span class="fu">length</span>(date) )</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co"># set xts object</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>my_xts <span class="ot">&lt;-</span> <span class="fu">xts</span>(my_mat,</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">order.by =</span> date)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co"># set correct colnames</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(my_xts) <span class="ot">&lt;-</span> ticker</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="co"># check it!</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;            ABEV3 BBAS3  BBDC3
R&gt; 2010-01-01 29.81 59.40 736.67
R&gt; 2010-01-04 30.82 59.80 764.14
R&gt; 2010-01-05 30.38 59.20 768.63
R&gt; 2010-01-06 30.20 59.28 776.47</code></pre>
</div>
</div>
<p>O código anterior pode dar a impressão de que o objeto <code>my_xts</code> é semelhante a um <code>dataframe</code>, porém, não se engane. Por estar indexado a um vetor de tempo, objeto <code>my_xts</code> pode ser utilizado para uma série de procedimentos temporais, tal como uma agregação por período temporal. Veja o exemplo a seguir, onde agregamos duas variáveis de tempo através do cálculo de uma média a cada semana.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>my_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, N), <span class="fu">seq</span>(N, <span class="dv">1</span>)), <span class="at">nrow=</span>N)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>my_xts <span class="ot">&lt;-</span> <span class="fu">xts</span>(my_mat, <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="st">'2016-01-01'</span>)<span class="sc">+</span><span class="dv">1</span><span class="sc">:</span>N)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>my_xts.weekly.mean <span class="ot">&lt;-</span> <span class="fu">apply.weekly</span>(my_xts, mean)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(my_xts.weekly.mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;             X.1   X.2
R&gt; 2016-01-03  1.5 499.5
R&gt; 2016-01-10  6.0 495.0
R&gt; 2016-01-17 13.0 488.0
R&gt; 2016-01-24 20.0 481.0
R&gt; 2016-01-31 27.0 474.0
R&gt; 2016-02-07 34.0 467.0</code></pre>
</div>
</div>
<p>Em Finanças e Economia, as agregações com objetos <strong>{xts}</strong> <span class="citation" data-cites="R-xts">(<a href="99-references.html#ref-R-xts" role="doc-biblioref"><strong>R-xts?</strong></a>)</span> são extremamente úteis quando se trabalha com dados em frequências de tempo diferentes. Por exemplo, é muito comum que se agregue dados de transação no mercado financeiro em alta frequência para intervalos maiores. Assim, dados que ocorrem a cada segundo são agregados para serem representados de 15 em 15 minutos. Esse tipo de procedimento é facilmente realizado no R através da correta representação dos dados como objetos <strong>{xts}</strong> <span class="citation" data-cites="R-xts">(<a href="99-references.html#ref-R-xts" role="doc-biblioref"><strong>R-xts?</strong></a>)</span>. Existem diversas outras funcionalidades desse pacote. Encorajo os usuários a ler o manual e aprender o que pode ser feito.</p>
<p>Indo além, existem diversos outros tipos de <code>dataframes</code> customizados. Por exemplo, o <code>dataframe</code> proposto pelo pacote <strong>{data.table}</strong> <span class="citation" data-cites="R-data.table">(<a href="99-references.html#ref-R-data.table" role="doc-biblioref"><strong>R-data.table?</strong></a>)</span> prioriza o tempo de operação nos dados e o uso de uma notação compacta para acesso e processamento. O <strong>{tibbletime}</strong> <span class="citation" data-cites="R-tibbletime">(<a href="99-references.html#ref-R-tibbletime" role="doc-biblioref"><strong>R-tibbletime?</strong></a>)</span> é uma versão orientada pelo tempo para <code>tibbles</code>. Caso o usuário esteja necessitando realizar operações de agregação de tempo, o uso deste pacote é fortemente recomendado.</p>
</section>
<section id="outras-funções-úteis" class="level3" data-number="8.1.10">
<h3 data-number="8.1.10" class="anchored" data-anchor-id="outras-funções-úteis"><span class="header-section-number">8.1.10</span> Outras Funções Úteis</h3>
<p><strong>head</strong> - Retorna os primeiros <code>n</code> elementos de um <code>dataframe</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">col1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>, <span class="at">col2 =</span> <span class="fu">rep</span>(<span class="st">'a'</span>, <span class="dv">5000</span>))</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my_df, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;    col1 col2 
R&gt;   &lt;int&gt; &lt;chr&gt;
R&gt; 1     1 a    
R&gt; 2     2 a    
R&gt; 3     3 a    
R&gt; 4     4 a    
R&gt; 5     5 a</code></pre>
</div>
</div>
<p><strong>tail</strong> - Retorna os últimos <code>n</code> elementos de um <code>dataframe</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(my_df, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;    col1 col2 
R&gt;   &lt;int&gt; &lt;chr&gt;
R&gt; 1  4996 a    
R&gt; 2  4997 a    
R&gt; 3  4998 a    
R&gt; 4  4999 a    
R&gt; 5  5000 a</code></pre>
</div>
</div>
<p><strong>complete.cases</strong> - Retorna um vetor lógico que testa se as linhas contêm apenas valores existentes e nenhum <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>my_x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>my_y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(my_x, my_y)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 7 × 2
R&gt;    my_x  my_y
R&gt;   &lt;dbl&gt; &lt;int&gt;
R&gt; 1     1     5
R&gt; 2     2     6
R&gt; 3     3     7
R&gt; 4     4     8
R&gt; 5     5     9
R&gt; 6    NA    10
R&gt; 7    10    NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">complete.cases</span>(my_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">complete.cases</span>(my_df)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 6 7</code></pre>
</div>
</div>
<p><strong>na.omit</strong> - Retorna um <code>dataframe</code> sem as linhas onde valores <code>NA</code> são encontrados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">na.omit</span>(my_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;    my_x  my_y
R&gt;   &lt;dbl&gt; &lt;int&gt;
R&gt; 1     1     5
R&gt; 2     2     6
R&gt; 3     3     7
R&gt; 4     4     8
R&gt; 5     5     9</code></pre>
</div>
</div>
<p><strong>unique</strong> - Retorna um <code>dataframe</code> onde todas as linhas duplicadas são eliminadas e somente os casos únicos são mantidos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">col1 =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">col2 =</span> <span class="fu">c</span>(<span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>,<span class="st">'B'</span>,<span class="st">'D'</span>))</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 7 × 2
R&gt;    col1 col2 
R&gt;   &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1 A    
R&gt; 2     1 A    
R&gt; 3     2 A    
R&gt; 4     3 C    
R&gt; 5     3 C    
R&gt; 6     4 B    
R&gt; 7     5 D</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">unique</span>(my_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;    col1 col2 
R&gt;   &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1 A    
R&gt; 2     2 A    
R&gt; 3     3 C    
R&gt; 4     4 B    
R&gt; 5     5 D</code></pre>
</div>
</div>
</section>
</section>
<section id="listas" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="listas"><span class="header-section-number">8.2</span> Listas</h2>
<p>Uma lista (<code>list</code>) é uma classe de objeto extremamente flexível e já tivemos contato com ela nos capítulos anteriores. Ao contrário de vetores atômicos, a lista não apresenta restrição alguma em relação aos tipos de elementos nela contidos. Podemos agrupar valores numéricos com caracteres, fatores com datas e até mesmo listas dentro de listas. Quando agrupamos vetores, também não é necessário que os mesmos tenham um número igual de elementos. Além disso, podemos dar um nome a cada elemento. Essas propriedades fazem da lista o objeto mais flexível para o armazenamento e estruturação de dados no R. Não é acidental o fato de que listas são muito utilizadas como retorno de funções.</p>
<section id="criando-listas" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="criando-listas"><span class="header-section-number">8.2.1</span> Criando Listas</h3>
<p>Uma lista pode ser criada através do comando <strong>list()</strong> , seguido por seus elementos separados por vírgula:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create list</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">'a'</span>, <span class="st">'b'</span>),</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">factor</span>(<span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span>),</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">tibble</span>(<span class="at">col1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use base::print</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [[1]]
R&gt; [1] 1 2 3
R&gt; 
R&gt; [[2]]
R&gt; [1] "a" "b"
R&gt; 
R&gt; [[3]]
R&gt; [1] &lt;NA&gt;
R&gt; Levels: C
R&gt; 
R&gt; [[4]]
R&gt; # A tibble: 5 × 1
R&gt;    col1
R&gt;   &lt;int&gt;
R&gt; 1     1
R&gt; 2     2
R&gt; 3     3
R&gt; 4     4
R&gt; 5     5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use dplyr::glimpse</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 4
R&gt;  $ : num [1:3] 1 2 3
R&gt;  $ : chr [1:2] "a" "b"
R&gt;  $ : Factor w/ 1 level "C": NA
R&gt;  $ : tibble [5 × 1] (S3: tbl_df/tbl/data.frame)
R&gt;   ..$ col1: int [1:5] 1 2 3 4 5</code></pre>
</div>
</div>
<p>Note que juntamos no mesmo objeto um vetor atômico numérico, outro de texto, um fator e um <code>tibble</code>. A apresentação de listas com o comando <strong>print()</strong> é diferente dos casos anteriores. Os elementos são separados verticalmente e os seus índices aparecem com duplo colchete (<code>[[ ]]</code>). Conforme será explicado logo a seguir, é dessa forma que os elementos de uma lista são armazenados e acessados.</p>
<p>Assim como para os demais tipos de objeto, os elementos de uma lista também podem ter nomes, o que facilita o entendimento e a interpretação das informações do problema em análise. Por exemplo, considere o caso de uma base de dados com informações sobre determinada ação negociada na bolsa. Nesse caso, podemos definir uma lista como:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set named list</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>my_named_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ticker =</span> <span class="st">'TICK4'</span>,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">market =</span> <span class="st">'Bovespa'</span>,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">df_prices =</span> <span class="fu">tibble</span>(<span class="at">P =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="fl">2.3</span>),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">ref_date =</span> <span class="fu">Sys.Date</span>()<span class="sc">+</span><span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check content</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(my_named_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 3
R&gt;  $ ticker   : chr "TICK4"
R&gt;  $ market   : chr "Bovespa"
R&gt;  $ df_prices: tibble [4 × 2] (S3: tbl_df/tbl/data.frame)
R&gt;   ..$ P       : num [1:4] 1 1.5 2 2.3
R&gt;   ..$ ref_date: Date[1:4], format: "2024-01-10" ...</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dica
</div>
</div>
<div class="callout-body-container callout-body">
<p>Toda vez que for trabalhar com listas, facilite a sua vida ao nomear todos os elementos de forma intuitiva. Isso facilita o acesso aos elementos e evita possíveis erros no código.</p>
</div>
</div>
</section>
<section id="acessando-os-elementos-de-uma-lista" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="acessando-os-elementos-de-uma-lista"><span class="header-section-number">8.2.2</span> Acessando os Elementos de uma Lista</h3>
<p>Os elementos de uma lista podem ser acessados através do uso de duplo colchete (<code>[[ ]]</code>), tal como em:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># accessing elements from list</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_named_l[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "Bovespa"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_named_l[[<span class="dv">3</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; # A tibble: 4 × 2
R&gt;       P ref_date  
R&gt;   &lt;dbl&gt; &lt;date&gt;    
R&gt; 1   1   2024-01-10
R&gt; 2   1.5 2024-01-11
R&gt; 3   2   2024-01-12
R&gt; 4   2.3 2024-01-13</code></pre>
</div>
</div>
<p>Também é possível acessar os elementos com um colchete simples (<code>[ ]</code>), porém, tome cuidado com essa operação, pois o resultado não vai ser o objeto em si, mas uma outra lista. Esse é um equívoco muito fácil de passar despercebido, resultando em erros no código. Veja a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set list</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">'a'</span>,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">factor</span>(<span class="st">'a'</span>,<span class="st">'b'</span>))</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check classes</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(my_l[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(my_l[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "list"</code></pre>
</div>
</div>
<p>Caso tentarmos somar um elemento a <code>my_l[2]</code>, teremos uma mensagem de erro:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>my_l[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>R&gt; Error in my_l[2] + 1: non-numeric argument to binary operator</code></pre>
</div>
</div>
<p>Esse erro ocorre devido ao fato de que uma lista não tem operador de soma. Para corrigir, basta utilizar o duplo colchete, tal como em <code>my_l[[2]]+1</code>. O acesso a elementos de uma lista com colchete simples somente é útil quando estamos procurando uma sublista dentro de uma lista maior. No exemplo anterior, caso quiséssemos obter o primeiro e o segundo elemento da lista <code>my_l</code>, usaríamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set new list</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>my_new_l <span class="ot">&lt;-</span> my_l[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check contents</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_new_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [[1]]
R&gt; [1] "a"
R&gt; 
R&gt; [[2]]
R&gt; [1] 1 2 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(my_new_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "list"</code></pre>
</div>
</div>
<p>No caso de listas com elementos nomeados, os mesmos podem ser acessados por seu nome através do uso do símbolo <code>$</code> tal como em <code>my_named_l$df_prices</code> ou <code>[['nome']]</code>, tal como em <code>my_named_l[['df_prices']]</code>. Em geral, essa é uma forma mais eficiente e recomendada de interagir com os elementos de uma lista. Como regra geral no uso do R, sempre dê preferência ao acesso de elementos através de seus nomes, seja em listas, vetores ou <code>dataframes</code>. Isso evita erros, pois, ao modificar os dados e adicionar algum outro objeto na lista, é possível que o ordenamento interno mude e, portanto, a posição de determinado objeto pode acabar sendo modificada.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dica
</div>
</div>
<div class="callout-body-container callout-body">
<p>Saiba que a ferramenta de <em>autocomplete</em> do RStudio também funciona para listas. Para usar, digite o nome da lista seguido de <code>$</code> e aperte <em>tab</em>. Uma caixa de diálogo com todos os elementos disponíveis na lista irá aparecer. A partir disso, basta selecionar apertando <em>enter</em>.</p>
</div>
</div>
<p>Veja os exemplos a seguir, onde são apresentadas as diferentes formas de se acessar uma lista.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># different ways to access a list</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>my_named_l<span class="sc">$</span>ticker</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>my_named_l<span class="sc">$</span>price</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>my_named_l[[<span class="st">'ticker'</span>]]</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>my_named_l[[<span class="st">'price'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vale salientar que também é possível acessar diretamente os elementos de um vetor que esteja dentro de uma lista através de colchetes encadeados. Veja a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># accessing elements of a vector in a list</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">'a'</span>, <span class="st">'b'</span>))</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_l[[<span class="dv">1</span>]][<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_l[[<span class="dv">2</span>]][<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "a"</code></pre>
</div>
</div>
<p>Tal operação é bastante útil quando interessa apenas um elemento dentro de um objeto maior criado por alguma função.</p>
</section>
<section id="adicionando-e-removendo-elementos-de-uma-lista" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="adicionando-e-removendo-elementos-de-uma-lista"><span class="header-section-number">8.2.3</span> Adicionando e Removendo Elementos de uma Lista</h3>
<p>A remoção, adição e substituição de elementos de uma lista também são procedimentos fáceis. Para adicionar ou substituir, basta definir um novo objeto na posição desejada da lista:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set list</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">'a'</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 3
R&gt;  $ : chr "a"
R&gt;  $ : num 1
R&gt;  $ : num 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add new elements to list</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>my_l[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>my_l[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'b'</span>)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print result</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 4
R&gt;  $ : chr "a"
R&gt;  $ : chr "b"
R&gt;  $ : num 3
R&gt;  $ : int [1:5] 1 2 3 4 5</code></pre>
</div>
</div>
<p>A operação também é possível com o uso de nomes e operador <code>$</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set list</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">elem1 =</span> <span class="st">'a'</span>, <span class="at">name1=</span><span class="dv">5</span>)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set new element</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>my_l<span class="sc">$</span>name2 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 3
R&gt;  $ elem1: chr "a"
R&gt;  $ name1: num 5
R&gt;  $ name2: num 10</code></pre>
</div>
</div>
<p>Para remover elementos de uma lista, basta definir o elemento para o símbolo reservado <code>NULL</code> (nulo):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set list</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">'b'</span>, <span class="at">num1 =</span> <span class="dv">2</span>, <span class="at">num2 =</span> <span class="dv">4</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 3
R&gt;  $ text: chr "b"
R&gt;  $ num1: num 2
R&gt;  $ num2: num 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove elements</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>my_l[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 2
R&gt;  $ text: chr "b"
R&gt;  $ num1: num 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>my_l<span class="sc">$</span>num1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 1
R&gt;  $ text: chr "b"</code></pre>
</div>
</div>
<p>Outra maneira de retirar elementos de uma lista é utilizando um índice negativo para os elementos indesejados. Observe a seguir, onde eliminamos o segundo elemento de uma lista:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set list</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="st">'texto'</span>)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="co"># remove second element</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_l[[<span class="sc">-</span><span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;  num 1</code></pre>
</div>
</div>
<p>Assim como no caso de vetores atômicos, essa remoção também pode ser realizada por condições lógicas. Veja a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set list</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co"># remove elements by condition</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>my_l[my_l <span class="sc">&gt;</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; List of 2
R&gt;  $ : num 1
R&gt;  $ : num 2</code></pre>
</div>
</div>
<p>Porém, note que esse atalho só funciona porque todos os elementos de <code>my_l</code> são numéricos.</p>
</section>
<section id="processando-os-elementos-de-uma-lista" class="level3" data-number="8.2.4">
<h3 data-number="8.2.4" class="anchored" data-anchor-id="processando-os-elementos-de-uma-lista"><span class="header-section-number">8.2.4</span> Processando os Elementos de uma Lista</h3>
<p>Um ponto importante a ser destacado a respeito de listas é que os seus elementos podem ser processados e manipulados individualmente através de funções específicas. Este é um tópico particular de programação com o R, mas que vale a apresentação aqui.</p>
<p>Por exemplo, imagine uma lista com vetores numéricos de diferentes tamanhos, tal como a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set list</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>my_l_num <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Caso quiséssemos calcular a média de cada elemento de <code>my_l_num</code> e apresentar o resultado na tela como um vetor, poderíamos fazer isso através de um procedimento simples, processando cada elemento individualmente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean of vectors</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>mean_1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(my_l_num[[<span class="dv">1</span>]])</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>mean_2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(my_l_num[[<span class="dv">2</span>]])</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>mean_3 <span class="ot">&lt;-</span> <span class="fu">mean</span>(my_l_num[[<span class="dv">3</span>]])</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print it</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(mean_1, mean_2, mean_3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1]  2.0 25.5  0.0</code></pre>
</div>
</div>
<p>O código anterior funciona, porém não é recomendado devido sua falta de escabilidade. Isto é, caso aumentássemos o volume de dados ou objetos, o código não funcionaria corretamente. Se, por exemplo, tivéssemos um quarto elemento em <code>my_l_num</code> e quiséssemos manter essa estrutura do código, teríamos que adicionar uma nova linha <code>mean_4 &lt;- mean(my_l_num[[4]])</code> e modificar o comando de saída na tela para <code>print(c(mean_1, mean_2, mean_3, mean_4))</code>.</p>
<p>Uma maneira mais fácil, elegante e inteligente seria utilizar a função <strong>sapply()</strong> . Nela, basta indicar o nome do objeto de tipo lista e a função que queremos utilizar para processar cada elemento. Internamente, os cálculos são realizados automaticamente. Veja a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using sapply</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>my_mean <span class="ot">&lt;-</span> <span class="fu">sapply</span>(my_l_num, mean)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print result</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1]  2.0 25.5  0.0</code></pre>
</div>
</div>
<p>O uso da função <strong>sapply()</strong> é preferível por ser mais compacto e eficiente do que a alternativa – a criação de <code>mean_1</code>, <code>mean_2</code> e <code>mean_3</code>. Note que o primeiro código, com médias individuais, só funciona para uma lista com três elementos. A função <strong>sapply()</strong> , ao contrário, funcionaria da mesma forma em listas de qualquer tamanho. Caso tivéssemos mais elementos, nenhuma modificação seria necessária no código anterior, o que o torna extensível a chegada de novos dados.</p>
<p>Essa visão e implementação de código voltado a procedimentos genéricos é um dos lemas para tornar o uso do R mais eficiente. <strong>A regra é simples: sempre escreva códigos que sejam adaptáveis a chegada de novos dados</strong>. Em inglês, isso é chamado de regra <em>DRY</em> (<em>don’t repeat yourself</em>). Caso você esteja repetindo códigos e abusando do <em>control + c/control + v</em>, como no exemplo anterior, certamente existe uma solução mais elegante e flexível que poderia ser utilizada. No R, existem diversas outras funções da família <code>apply</code> para esse objetivo. Essas funções serão explicadas com maiores detalhes no capítulo <a href="10-intro-programacao.html"><span>Chapter&nbsp;10</span></a>.</p>
</section>
<section id="outras-funções-úteis-1" class="level3" data-number="8.2.5">
<h3 data-number="8.2.5" class="anchored" data-anchor-id="outras-funções-úteis-1"><span class="header-section-number">8.2.5</span> Outras Funções Úteis</h3>
<p><strong>unlist</strong> - Retorna os elementos de uma lista em um único vetor atômico.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>my_named_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ticker =</span> <span class="st">'XXXX4'</span>,</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">price =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">market =</span> <span class="st">'Bovespa'</span>)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>my_unlisted <span class="ot">&lt;-</span> <span class="fu">unlist</span>(my_named_l)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_unlisted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt;    ticker    price1    price2    price3    price4    market 
R&gt;   "XXXX4"       "1"     "1.5"       "2"       "3" "Bovespa"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(my_unlisted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "character"</code></pre>
</div>
</div>
<p><strong>as.list</strong> - Converte um objeto para uma lista, tornando cada elemento um elemento da lista.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>my_x <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">13</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>my_x_as_list <span class="ot">&lt;-</span> <span class="fu">as.list</span>(my_x)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_x_as_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [[1]]
R&gt; [1] 10
R&gt; 
R&gt; [[2]]
R&gt; [1] 11
R&gt; 
R&gt; [[3]]
R&gt; [1] 12
R&gt; 
R&gt; [[4]]
R&gt; [1] 13</code></pre>
</div>
</div>
<p><strong>names</strong> - Retorna ou define os nomes dos elementos de uma lista. Assim como para o caso de nomear elementos de um vetor atômico, usa-se a função <strong>names()</strong> alocada ao lado esquerdo do símbolo <code>&lt;-</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">value1 =</span> <span class="dv">1</span>, <span class="at">value2 =</span> <span class="dv">2</span>, <span class="at">value3 =</span> <span class="dv">3</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(my_l))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; [1] "value1" "value2" "value3"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>my_l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(my_l) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'num1'</span>, <span class="st">'num2'</span>, <span class="st">'num3'</span>)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(my_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R&gt; $num1
R&gt; [1] 1
R&gt; 
R&gt; $num2
R&gt; [1] 2
R&gt; 
R&gt; $num3
R&gt; [1] 3</code></pre>
</div>
</div>
</section>
</section>
<section id="exerc-classe-estrutura" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="exerc-classe-estrutura"><span class="header-section-number">8.3</span> Exercícios</h2>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-R-base" class="csl-entry" role="listitem">
R Core Team. 2023. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-R-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley. 2023. <em>Tidyverse: Easily Install and Load the Tidyverse</em>. <a href="https://tidyverse.tidyverse.org">https://tidyverse.tidyverse.org</a>.
</div>
<div id="ref-R-dplyr" class="csl-entry" role="listitem">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis Vaughan. 2023. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://dplyr.tidyverse.org">https://dplyr.tidyverse.org</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./07-importacao-internet.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Importação de Dados via Pacotes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-objetos-basicos.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">As Classes Básicas de Objetos</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>