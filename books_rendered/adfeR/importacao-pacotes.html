<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 5 Importação de Dados via Pacotes | Análise de Dados Financeiros e Econômicos com o R - Versão Online</title>
<meta name="author" content="Marcelo S. Perlin (marcelo.perlin@ufrgs.br)">
<meta name="description" content="window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-120530145-1');  Uma das grandes vantagens de se utilizar o R é...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Capítulo 5 Importação de Dados via Pacotes | Análise de Dados Financeiros e Econômicos com o R - Versão Online">
<meta property="og:type" content="book">
<meta property="og:image" content="/00-text-resources/cover/CAPAdigital-AnaliseDadosR.jpg">
<meta property="og:description" content="window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-120530145-1');  Uma das grandes vantagens de se utilizar o R é...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 5 Importação de Dados via Pacotes | Análise de Dados Financeiros e Econômicos com o R - Versão Online">
<meta name="twitter:description" content="window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-120530145-1');  Uma das grandes vantagens de se utilizar o R é...">
<meta name="twitter:image" content="/00-text-resources/cover/CAPAdigital-AnaliseDadosR.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>

        /* update total correct if #total_correct exists */
        update_total_correct = function() {
          if (t = document.getElementById("total_correct")) {
            t.innerHTML =
              document.getElementsByClassName("correct").length + " of " +
              document.getElementsByClassName("solveme").length + " correct";
          }
        }
        
        /* solution button toggling function */
        b_func = function() {
          var cl = this.parentElement.classList;
          if (cl.contains('open')) {
            cl.remove("open");
          } else {
            cl.add("open");
          }
        }
        
        /* function for checking solveme answers */
        solveme_func = function(e) {
          var real_answers = JSON.parse(this.dataset.answer);
          var my_answer = this.value;
          var cl = this.classList;
          if (cl.contains("ignorecase")) {
            my_answer = my_answer.toLowerCase();
          }
          if (cl.contains("nospaces")) {
            my_answer = my_answer.replace(/ /g, "");
          }
          
          if (my_answer !== "" & real_answers.includes(my_answer)) {
            cl.add("correct");
          } else {
            cl.remove("correct");
          }
        
          // match numeric answers within a specified tolerance
          if(this.dataset.tol > 0){
            var tol = JSON.parse(this.dataset.tol);  
            var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
            if (matches.reduce((a, b) => a + b, 0) > 0) {
              cl.add("correct");
            } else {
              cl.remove("correct");
            }  
          }
        
          // added regex bit
          if (cl.contains("regex")){
            answer_regex = RegExp(real_answers.join("|"))
            if (answer_regex.test(my_answer)) {
              cl.add("correct");
            }  
          }
          
          update_total_correct();
        }
        
        window.onload = function() {
          /* set up solution buttons */
          var buttons = document.getElementsByTagName("button");
        
          for (var i = 0; i < buttons.length; i++) {
            if (buttons[i].parentElement.classList.contains('solution')) {
              buttons[i].onclick = b_func;
            }
          }
          
          /* set up solveme inputs */
          var solveme = document.getElementsByClassName("solveme");
        
          for (var i = 0; i < solveme.length; i++) {
            /* make sure input boxes don't auto-anything */
            solveme[i].setAttribute("autocomplete","off");
            solveme[i].setAttribute("autocorrect", "off");
            solveme[i].setAttribute("autocapitalize", "off"); 
            solveme[i].setAttribute("spellcheck", "false");
            solveme[i].value = "";
            
            /* adjust answer for ignorecase or nospaces */
            var cl = solveme[i].classList;
            var real_answer = solveme[i].dataset.answer;
            if (cl.contains("ignorecase")) {
              real_answer = real_answer.toLowerCase();
            }
            if (cl.contains("nospaces")) {
              real_answer = real_answer.replace(/ /g, "");
            }
            solveme[i].dataset.answer = real_answer;
            
            /* attach checking function */
            solveme[i].onkeyup = solveme_func;
            solveme[i].onchange = solveme_func;
          }
          
          update_total_correct();
        }
        
        </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="00-code-resources/css/style_html.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Análise de Dados Financeiros e Econômicos com o R - Versão Online</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bem vindo!</a></li>
<li><a class="" href="sobre-nova-edi%C3%A7%C3%A3o.html">Sobre Nova Edição</a></li>
<li><a class="" href="pref%C3%A1cio.html">Prefácio</a></li>
<li><a class="" href="introducao.html"><span class="header-section-number">1</span> Introdução</a></li>
<li><a class="" href="operacoes-basicas.html"><span class="header-section-number">2</span> Operações Básicas no R</a></li>
<li><a class="" href="scripts-pesquisa.html"><span class="header-section-number">3</span> Desenvolvendo Rotinas de Pesquisa</a></li>
<li><a class="" href="importacao-exportacao.html"><span class="header-section-number">4</span> Importação e Exportação de Dados Locais</a></li>
<li><a class="active" href="importacao-pacotes.html"><span class="header-section-number">5</span> Importação de Dados via Pacotes</a></li>
<li><a class="" href="classe-estrutura.html"><span class="header-section-number">6</span> Dataframes e outros Objetos</a></li>
<li><a class="" href="classes-basicas.html"><span class="header-section-number">7</span> As Classes Básicas de Objetos</a></li>
<li><a class="" href="programacao.html"><span class="header-section-number">8</span> Programando com o R</a></li>
<li><a class="" href="limpando-estruturando.html"><span class="header-section-number">9</span> Estruturando e Limpando Dados</a></li>
<li><a class="" href="figuras.html"><span class="header-section-number">10</span> Visualizando Dados</a></li>
<li><a class="" href="modelos.html"><span class="header-section-number">11</span> Econometria Financeira com o R</a></li>
<li><a class="" href="reportando-resultados.html"><span class="header-section-number">12</span> Reportando Resultados e Criando Relatórios</a></li>
<li><a class="" href="otimizacao.html"><span class="header-section-number">13</span> Otimização de Código</a></li>
<li><a class="" href="refer%C3%AAncias.html">Referências</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-120530145-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120530145-1');
</script><div id="importacao-pacotes" class="section level1" number="5">
<h1>
<span class="header-section-number">Capítulo 5</span> Importação de Dados via Pacotes<a class="anchor" aria-label="anchor" href="#importacao-pacotes"><i class="fas fa-link"></i></a>
</h1>
<p>Uma das grandes vantagens de se utilizar o R é a quantidade de dados que podem ser importados através da internet. Isso é especialmente prático pois uma base de dados pode ser atualizada através de um simples comando, evitando o tedioso trabalho de coleta manual. Ao usarmos pacotes para importar dados, esta etapa da pesquisa se torna reproduzível e mais rápida, facilitando o compartilhamento e futura execução do nosso código.</p>
<p>Neste capítulo vou descrever e dar exemplos de importação de dados para os mais importantes e estáveis pacotes especializados na importação de para dados financeiros e econômicos no Brasil e exterior. A lista inclui:</p>
<dl>
<dt>
<code>GetQuandlData</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-GetQuandlData" role="doc-biblioref">M. S. Perlin 2019</a>)</span>
</dt>
<dd>
Importa dados econômicos e financeiros do vasto repositório de dados da plataforma <em>Quandl</em>.
</dd>
<dt>
<code>BatchGetSymbols</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-BatchGetSymbols" role="doc-biblioref">M. Perlin 2022a</a>)</span>
</dt>
<dd>
Importa dados de preços diários de ações e índices do <em>Yahoo Finance</em>.
</dd>
<dt>
<code>GetTDData</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-GetTDData" role="doc-biblioref">M. Perlin 2022c</a>)</span>
</dt>
<dd>
Importa dados de títulos de dívida pública do Brasil diretamente do site do Tesouro Direto.
</dd>
<dt>
<code>GetBCBData</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-GetBCBData" role="doc-biblioref">M. Perlin 2022b</a>)</span>
</dt>
<dd>
Importa dados do grande repositório de séries temporais do Banco Central do Brasil, local obrigatório para qualquer economista que trabalha com dados.
</dd>
<dt>
<code>GetDFPData2</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-GetDFPData2" role="doc-biblioref">M. Perlin and Kirch 2022a</a>)</span>
</dt>
<dd>
Importa dados do sistema DFP – Demonstrativos Financeiros Padronizados – de empresas negociadas na B3, a bolsa Brasileira. O repositório inclui documentos financeiros tal como o balanço patrimonial, demonstrativos de resultados, entre vários outros.
</dd>
<dt>
<code>GetFREData</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-GetFREData" role="doc-biblioref">M. Perlin and Kirch 2022b</a>)</span>
</dt>
<dd>
Importa dados do sistema FRE – Formulário de Referência – da bolsa Brasileira. Esta inclui diversos eventos e informações corporativas tal como composição do conselho e diretoria, remuneração dos conselheiros, entre outras.
</dd>
</dl>
<div id="quandl" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Pacote <code>GetQuandlData</code><a class="anchor" aria-label="anchor" href="#quandl"><i class="fas fa-link"></i></a>
</h2>
<p><em>Quandl</em> é um repositório de dados abrangente, fornecendo acesso a uma série de tabelas gratuitas e pagas disponibilizadas por diversas instituições de pesquisa. Como ponto inicial, recomendo fortemente que você navegue nas tabelas disponíveis no <a href="https://www.quandl.com/">site da Quandl</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.quandl.com/" class="uri"&gt;https://www.quandl.com/&lt;/a&gt;&lt;/p&gt;'><sup>18</sup></a>. Verás que uma grande proporção dos repositórios de dados abertos em economia e finanças também estão disponíveis no Quandl. </p>
<p>Pacote <code>Quandl</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-Quandl" role="doc-biblioref">Raymond McTaggart, Gergely Daroczi, and Clement Leung 2021</a>)</span> é a extensão oficial oferecida pela empresa e disponível no CRAN. No entanto, o pacote tem alguns problemas quanto a estrutura de dados de saída<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Veja &lt;a href="https://www.msperlin.com/post/2019-10-01-new-package-getquandldata/"&gt;postagem no blog&lt;/a&gt;&lt;/p&gt;'><sup>19</sup></a> e, para resolver, escrevi o meu próprio pacote <code>GetQuandlData</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-GetQuandlData" role="doc-biblioref">M. S. Perlin 2019</a>)</span>. O diferencial de <code>GetQuandlData</code> é a saída de dados já estruturados, prontos para uma posterior análise.</p>
<p>A <strong>primeira e obrigatória</strong> etapa no uso de <code>GetQuandlData</code> é registrar o usuário no <a href="https://www.quandl.com/">site</a>. Logo em seguida, vá para <em>Account Settings</em> e procure pela seção <em>You API Key</em>. Este local deve mostrar uma senha, tal como <code>Asv8Ac7zuZzJSCGxynfG</code>. Copie o texto para a área de transferência (<em>control + c</em>) e, no R, defina um objeto de contendo o conteúdo copiado da seguinte maneira:</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set FAKE api key to quandl</span></span>
<span><span class="va">my_api_key</span> <span class="op">&lt;-</span> <span class="st">'Asv8Ac7zuZzJSCGxynfG'</span></span></code></pre></div>
<p>Essa chave API é exclusiva para cada usuário e a apresentada aqui <strong>não funcionará no seu computador</strong>. Você precisará obter sua própria chave de API para executar os exemplos do livro. Depois de encontrar e definir sua chave, vá para o <a href="https://www.quandl.com/search">site do Quandl</a> e use a caixa de pesquisa para procurar o símbolo da série temporal de interesse.</p>
<p>Como exemplo, usaremos dados do <a href="https://www.quandl.com/data/LBMA/GOLD-Gold-Price-London-Fixing">preço do ouro</a> no mercado Londrino. O código para esta série no Quandl é <code>'LBMA/GOLD'</code>. Observe que a estrutura de um identificador de tabelas no Quandl é sempre a mesma, com o nome do banco de dados primeiro e o nome da tabela depois, separados por uma barra (/).</p>
<p>Agora, com a chave API e o identificador da tabela, usamos a função <code>get_Quandl_series</code> para baixar os dados de 1980-01-01 a 2021-01-01: </p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetQuandlData/">GetQuandlData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set symbol and dates</span></span>
<span><span class="va">my_symbol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'GOLD'</span> <span class="op">=</span> <span class="st">'LBMA/GOLD'</span><span class="op">)</span></span>
<span><span class="va">first_date</span> <span class="op">&lt;-</span> <span class="st">'1980-01-01'</span></span>
<span><span class="va">last_date</span> <span class="op">&lt;-</span> <span class="st">'2021-01-01'</span></span>
<span></span>
<span><span class="co"># get data!</span></span>
<span><span class="va">df_quandl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetQuandlData/man/get_Quandl_series.html">get_Quandl_series</a></span><span class="op">(</span>id_in <span class="op">=</span> <span class="va">my_symbol</span>,</span>
<span>                               api_key <span class="op">=</span> <span class="va">my_api_key</span>, </span>
<span>                               first_date <span class="op">=</span> <span class="va">first_date</span>,</span>
<span>                               last_date <span class="op">=</span> <span class="va">last_date</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check it</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_quandl</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 10,763
R&gt; Columns: 9
R&gt; $ `USD (AM)`  &lt;chr&gt; "1766.6", "1772.9", "1766.75", "1758.9…
R&gt; $ `USD (PM)`  &lt;chr&gt; "1761.25", "1779.75", "1772.4", "1753.…
R&gt; $ `GBP (AM)`  &lt;chr&gt; "1450.03", "1452.36", "1443.26", "1447…
R&gt; $ `GBP (PM)`  &lt;chr&gt; "1451.62", "1457.26", "1444.86", "1451…
R&gt; $ `EURO (AM)` &lt;chr&gt; "1734.09", "1732.3", "1722.23", "1724.…
R&gt; $ `EURO (PM)` &lt;chr&gt; "1735.54", "1743.62", "1727.91", "1725…
R&gt; $ series_name &lt;chr&gt; "GOLD", "GOLD", "GOLD", "GOLD", "GOLD"…
R&gt; $ ref_date    &lt;date&gt; 2022-08-03, 2022-08-02, 2022-08-01, 2…
R&gt; $ id_quandl   &lt;chr&gt; "LBMA/GOLD", "LBMA/GOLD", "LBMA/GOLD",…</code></pre>
<p>Observe como definimos o nome da série temporal em linha <code>id_in =  c('GOLD' = 'LBMA/GOLD')</code>. O nome do elemento – <code>GOLD</code> – se torna uma coluna chamada <code>series_name</code> no <code>dataframe</code> de saída. Se tivéssemos mais séries temporais, elas seriam empilhadas na mesma tabela.</p>
<p>Para verificar os dados, vamos criar um gráfico com os preços do ouro ao longo do tempo. Aqui, usaremos o pacote <code>ggplot2</code> para criar a figura. Por enquanto você não precisa se preocupar com o código de criação de gráficos. Teremos o capítulo <a href="figuras.html#figuras">10</a> inteiro dedicado ao tópico.</p>
<div class="inline-figure"><img src="adfeR_pt_ed03-ONLINE_files/figure-html/unnamed-chunk-171-1.png" width="672" style="display: block; margin: auto;"></div>
<p>De modo geral, os preços do ouro permaneceram relativamente estáveis entre 1980 e 2000, atingindo um pico após 2010. Uma possível explicação é a maior demanda por ativos mais seguros, como o ouro, após a crise financeira de 2009. No entanto, o ouro nunca foi um investimento eficiente a longo prazo. Para mostrar isso, vamos calcular seu retorno anual composto de 1980-01-02 a 2022-08-03:</p>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sort the rows</span></span>
<span><span class="va">df_quandl</span> <span class="op">&lt;-</span> <span class="va">df_quandl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>USD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">`USD (AM)`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">ref_date</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">df_quandl</span><span class="op">$</span><span class="va">USD</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">df_quandl</span><span class="op">$</span><span class="va">USD</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">total_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df_quandl</span><span class="op">$</span><span class="va">ref_date</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">df_quandl</span><span class="op">$</span><span class="va">ref_date</span><span class="op">)</span> <span class="op">)</span><span class="op">/</span><span class="fl">365</span></span>
<span></span>
<span><span class="va">comp_ret_per_year</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">total_ret</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">total_years</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">comp_ret_per_year</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 0.02737004</code></pre>
<p>Encontramos o resultado de que os preços do ouro em USD apresentam um retorno composto equivalente a 2,74% ao ano. Este não é um resultado de investimento impressionante de forma alguma. Como comparação, a inflação anual para os EUA no mesmo período é de 3,22% ao ano. Isso significa que, ao comprar ouro em 1980, o investidor recebeu menos que a inflação como retorno nominal, resultando em perda de poder de compra.</p>
<div id="importando-múltiplas-séries" class="section level3" number="5.1.1">
<h3>
<span class="header-section-number">5.1.1</span> Importando Múltiplas Séries<a class="anchor" aria-label="anchor" href="#importando-m%C3%BAltiplas-s%C3%A9ries"><i class="fas fa-link"></i></a>
</h3>
<p>Ao solicitar várias séries temporais do Quandl, pacote <code>GetQuandlData</code> empilha todos os dados em um único <code>dataframe</code>, tornando mais fácil trabalhar com as ferramentas do <code>tidyverse</code>. Como exemplo, vamos olhar para o banco de dados <code>RATEINF</code>, o qual contém séries temporais das taxas de inflação ao redor do mundo. Primeiro, precisamos ver quais são os conjuntos de dados disponíveis:</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetQuandlData/">GetQuandlData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># databse to get info</span></span>
<span><span class="va">db_id</span> <span class="op">&lt;-</span> <span class="st">'RATEINF'</span></span>
<span></span>
<span><span class="co"># get info </span></span>
<span><span class="va">df_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetQuandlData/man/get_database_info.html">get_database_info</a></span><span class="op">(</span><span class="va">db_id</span>, <span class="va">my_api_key</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_db</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 26
R&gt; Columns: 8
R&gt; $ code         &lt;chr&gt; "CPI_ARG", "CPI_AUS", "CPI_CAN", "CPI…
R&gt; $ name         &lt;chr&gt; "Consumer Price Index - Argentina", "…
R&gt; $ description  &lt;chr&gt; "Please visit &lt;a href=http://www.rate…
R&gt; $ refreshed_at &lt;dttm&gt; 2020-10-10 02:03:32, 2022-11-19 02:0…
R&gt; $ from_date    &lt;date&gt; 1988-01-31, 1948-09-30, 1989-01-31, …
R&gt; $ to_date      &lt;date&gt; 2013-12-31, 2022-09-30, 2022-10-31, …
R&gt; $ quandl_code  &lt;chr&gt; "RATEINF/CPI_ARG", "RATEINF/CPI_AUS",…
R&gt; $ quandl_db    &lt;chr&gt; "RATEINF", "RATEINF", "RATEINF", "RAT…</code></pre>
<p>Coluna <code>name</code> contém a descrição das tabelas com os seguintes nomes:</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df_db</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "Consumer Price Index - Argentina"  
R&gt;  [2] "Consumer Price Index - Australia"  
R&gt;  [3] "Consumer Price Index - Canada"     
R&gt;  [4] "Consumer Price Index - Switzerland"
R&gt;  [5] "Consumer Price Index - Germany"    
R&gt;  [6] "Consumer Price Index - Euro Area"  
R&gt;  [7] "Consumer Price Index - France"     
R&gt;  [8] "Consumer Price Index - UK"         
R&gt;  [9] "Consumer Price Index - Italy"      
R&gt; [10] "Consumer Price Index - Japan"      
R&gt; [11] "Consumer Price Index - New Zealand"
R&gt; [12] "Consumer Price Index - Russia"     
R&gt; [13] "Consumer Price Index - USA"        
R&gt; [14] "Inflation YOY - Argentina"         
R&gt; [15] "Inflation YOY - Australia"         
R&gt; [16] "Inflation YOY - Canada"            
R&gt; [17] "Inflation YOY - Switzerland"       
R&gt; [18] "Inflation YOY - Germany"           
R&gt; [19] "Inflation YOY - Euro Area"         
R&gt; [20] "Inflation YOY - France"            
R&gt; [21] "Inflation YOY - UK"                
R&gt; [22] "Inflation YOY - Italy"             
R&gt; [23] "Inflation YOY - Japan"             
R&gt; [24] "Inflation YOY - New Zealand"       
R&gt; [25] "Inflation YOY - Russia"            
R&gt; [26] "Inflation YOY - USA"</code></pre>
<p>O que estamos buscando são as séries <code>'Inflation YOY - *'</code>, as quais contém a inflação ano-ao-ano (<em>Year On Year</em> – <em>YOY</em>) de diferentes países. Vamos agora filtrar o <code>dataframe</code> para manter apenas as séries de inflação anual para quatro países selecionados:</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Inflation YOY - USA'</span>,</span>
<span>                     <span class="st">'Inflation YOY - Canada'</span>,</span>
<span>                     <span class="st">'Inflation YOY - Euro Area'</span>,</span>
<span>                     <span class="st">'Inflation YOY - Australia'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter selected countries</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="va">df_db</span><span class="op">$</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">selected_series</span></span>
<span><span class="va">df_db</span> <span class="op">&lt;-</span> <span class="va">df_db</span><span class="op">[</span><span class="va">idx</span>, <span class="op">]</span></span></code></pre></div>
<p>Agora importamos as séries usando <code>get_Quandl_series</code>:</p>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_id</span> <span class="op">&lt;-</span> <span class="va">df_db</span><span class="op">$</span><span class="va">quandl_code</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">my_id</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">df_db</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="va">first_date</span> <span class="op">&lt;-</span> <span class="st">'2010-01-01'</span></span>
<span><span class="va">last_date</span> <span class="op">&lt;-</span> <span class="st">'2021-01-01'</span></span>
<span></span>
<span><span class="va">df_inflation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetQuandlData/man/get_Quandl_series.html">get_Quandl_series</a></span><span class="op">(</span>id_in <span class="op">=</span> <span class="va">my_id</span>, </span>
<span>                                  api_key <span class="op">=</span> <span class="va">my_api_key</span>,</span>
<span>                                  first_date <span class="op">=</span> <span class="va">first_date</span>,</span>
<span>                                  last_date <span class="op">=</span> <span class="va">last_date</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_inflation</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 500
R&gt; Columns: 4
R&gt; $ series_name &lt;chr&gt; "Inflation YOY - Australia", "Inflatio…
R&gt; $ ref_date    &lt;date&gt; 2022-06-30, 2022-03-31, 2021-12-31, 2…
R&gt; $ value       &lt;dbl&gt; 6.1, 5.1, 3.5, 3.0, 3.8, 1.1, 0.9, 0.7…
R&gt; $ id_quandl   &lt;chr&gt; "RATEINF/INFLATION_AUS", "RATEINF/INFL…</code></pre>
<p>Por fim, construimos um gráfico para vizualizar as séries de inflação:</p>
<div class="inline-figure"><img src="adfeR_pt_ed03-ONLINE_files/figure-html/unnamed-chunk-178-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Como podemos ver, com algumas linhas de código do R conseguimos importar dados atualizados da inflação de diferentes regiões do mundo. O retorno de um <code>dataframe</code> no formato empilhado facilitou o processo de análise pois essa é a estrutura de dados que o <code>ggplot2</code> espera.</p>
</div>
</div>
<div id="pacote-batchgetsymbols" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Pacote <code>BatchGetSymbols</code><a class="anchor" aria-label="anchor" href="#pacote-batchgetsymbols"><i class="fas fa-link"></i></a>
</h2>
<p></p>
<p>Pacote <code>BatchGetSymbols</code> faz a comunicação do R com os dados financeiros disponíveis no <em>Yahoo Finance</em>. Essa gigantesca base de dados inclui valores agregados de preços e volumes negociados de ações na B3 e outras bolsas internacionais na frequência diária. Tudo que se precisa saber para acessar a base de dados são os identificadores das ações (<em>tickers</em>) e um período de tempo.</p>
<p>Os diferenciais do <code>BatchGetSymbols</code> são:</p>
<p><strong>Limpeza e organização</strong>: todos os dados financeiros de diferentes <em>tickers</em> são mantidos no mesmo <code>dataframe</code>, facilitando a análise futura com as ferramentas do <code>tidyverse</code>.</p>
<p><strong>Controle de erros de importação</strong>: todos erros de <em>download</em> são registrados na saída do programa. Caso uma ação em particular não exista no <em>Yahoo Finance</em>, esta será ignorada e apenas as demais disponíveis serão retornadas na saída do código;</p>
<p><strong>Comparação de datas a um <em>benchmark</em></strong>: os dados de ativos individuais são comparados com dados disponíveis para um ativo <em>benchmark</em>, geralmente um índice de mercado. Caso o número de datas faltantes seja maior que um determinado limite imposto pelo usuário, a ação é retirada do <code>dataframe</code> final.</p>
<p><strong>Uso de sistema de cache</strong>: no momento de acesso aos dados, os mesmos são salvos localmente no computador do usuário e são persistentes para cada sessão. Caso o usuário requisitar os mesmos dados na mesma sessão do R, o sistema de cache será utilizado. Se os dados desejados não estão disponíveis no cache, a função irá comparar e baixar apenas as informações que faltam. Isso aumenta significativamente a velocidade de acesso aos dados, ao mesmo tempo em que minimiza o uso da conexão a Internet;</p>
<div class="rmdimportant">
<p>
Desde versão 2.6 (2020-11-22) de <code>BatchGetSymbols</code> a pasta
<em>default</em> de cache do <code>BatchGetSymbols</code> se localiza no
diretório temporário da sessão do R. Assim, o cache é persistente apenas
para a sessão do usuário. Esta mudança foi motivada por quebras
estruturais nos dados do <em>Yahoo Finance</em>, onde os dados passados
registrados em cache não mais estavam corretos devido a eventos
coporativos. O usuário, porém, pode trocar a pasta de cache usando a
entrada <code>cache.folder</code>.
</p>
</div>
<p><strong>Acesso a <em>tickers</em> em índices de mercado</strong>: O pacote inclui funções para baixar a composição dos índices Ibovespa, SP500 e FTSE100. Isso facilita a importação de dados para uma grande quantidade de ações. Podes, por exemplo, baixar cotações de todas as ações que fazem parte de certo índice.</p>
<p><strong>Processamento paralelo</strong>: Caso o usuário estiver baixando um grande volume de dados do <em>Yahoo Finance</em>, uma opção para execução paralela está disponível. Isto é, ao invés de usar apenas um núcleo na requisição dos dados, usamos vários ao mesmo tempo. O efeito prático é, dependendo do número de núcleos do computador, uma diminuição significativa no tempo total de importação.</p>
<p><strong>Flexibilidade de formato</strong>: O pacote também oferece funções para modificar o formato dos dados. Caso o usuário deseje uma saída do <code>dataframe</code> no formato largo, onde <em>tickers</em> são colunas e as linhas os preços/retornos, basta chamar função <code><a href="https://rdrr.io/pkg/BatchGetSymbols/man/reshape.wide.html">BatchGetSymbols::reshape.wide</a></code>. Da mesma forma, uma transformação temporal também é possível. Se o usuário desejar dados na frequência semanal, mensal ou anual, basta indicar na entrada <code>freq.data</code> da função.</p>
<p>Como exemplo de uso, vamos baixar dados financeiros referentes a quatro ações no último ano (360 dias) usando a função de mesmo nome do pacote. Os <em>tickers</em> de cada ação podem ser encontrados nos próprios sites do <a href="https://br.financas.yahoo.com/"><em>Yahoo Finance</em></a>. Note que adicionamos texto <code>.SA</code> a cada um deles. Essa é uma notação específica do site e vale para qualquer ação Brasileira.</p>
<p>Na chamada da função <code>BatchGetSymbols</code>, utilizamos um valor de <code>0.95</code> (95%) para o <em>input</em> <code>thresh.bad.data</code> e <code>'^BVSP'</code> para <code>bench.ticker</code>. Isso faz com que a função compare as datas obtidas para cada ativo em relação ao nosso <em>benchmark</em>, o índice Ibovespa, cujo <em>ticker</em> no <em>Yahoo Finance</em> é <code>^BVSP</code>. Se, durante o processo de importação, uma ação individual não apresenta mais de 95% de casos válidos em relação ao <em>benchmark</em>, esta é retirada da saída.</p>
<p>
</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">BatchGetSymbols</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set tickers</span></span>
<span><span class="va">my_tickers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'PETR4.SA'</span>, <span class="st">'CIEL3.SA'</span>,</span>
<span>                <span class="st">'GGBR4.SA'</span>, <span class="st">'GOAU4.SA'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set dates and other inputs</span></span>
<span><span class="va">first_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">360</span></span>
<span><span class="va">last_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">thresh_bad_data</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>   <span class="co"># sets percent threshold for bad data</span></span>
<span><span class="va">bench_ticker</span> <span class="op">&lt;-</span> <span class="st">'^BVSP'</span>   <span class="co"># set benchmark as ibovespa</span></span>
<span></span>
<span><span class="va">l_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BatchGetSymbols/man/BatchGetSymbols.html">BatchGetSymbols</a></span><span class="op">(</span>tickers <span class="op">=</span> <span class="va">my_tickers</span>,</span>
<span>                         first.date <span class="op">=</span> <span class="va">first_date</span>,</span>
<span>                         last.date <span class="op">=</span> <span class="va">last_date</span>,</span>
<span>                         bench.ticker <span class="op">=</span> <span class="va">bench_ticker</span>,</span>
<span>                         thresh.bad.data <span class="op">=</span> <span class="va">thresh_bad_data</span><span class="op">)</span></span></code></pre></div>
<p>A saída de <code>BatchGetSymbols</code> é um objeto do tipo lista, ainda não visto no livro. Por enquanto, tudo que precisas saber é que uma lista é um objeto flexível, acomodando outros objetos em sua composição. O acesso a cada elemento de uma lista pode ser feito pelo operador <code>$</code>. No capítulo <a href="classe-estrutura.html#classe-estrutura">6</a> iremos estudar melhor esta classe de objetos.</p>
<div class="rmdcaution">
<p>
Note que as entradas da função
<code><a href="https://rdrr.io/pkg/BatchGetSymbols/man/BatchGetSymbols.html">BatchGetSymbols::BatchGetSymbols</a></code> usam o “.” em seus nomes,
tal como <code>thresh.bad.data</code>, e <code>bench.ticker</code>,
enquanto o livro está escrito usando o traço baixo (<code>_</code>), tal
como <code>thresh_bad_data</code>, e <code>bench_ticker</code>. Esta
diferença pode resultar em problemas se, na falta de atenção, o usuário
trocar um pelo outro. Como regra, procure dar prioridade para o uso de
traço baixo nos nomes de objetos. Infelizmente algumas funções escritas
no passado acabaram ficando com a estrutura antiga e, para não
prejudicar os usuários, os nomes das entradas foram mantidos.
</p>
</div>
<p>Voltando ao nosso exemplo, função <code>BatchGetSymbols</code> retorna uma lista com dois elementos: um <code>dataframe</code> com o resultado do processo de importação – <code>df_control</code> – e outro <code>dataframe</code> com os dados das ações – <code>df_tickers</code>. Vamos checar o conteúdo do primeiro dataframe.</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print result of download process</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">l_out</span><span class="op">$</span><span class="va">df.control</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 4 × 6
R&gt;   ticker   src   download.status total.obs perc.be…¹ thres…²
R&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;               &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
R&gt; 1 PETR4.SA yahoo OK                    246         1 KEEP   
R&gt; 2 CIEL3.SA yahoo OK                    246         1 KEEP   
R&gt; 3 GGBR4.SA yahoo OK                    246         1 KEEP   
R&gt; 4 GOAU4.SA yahoo OK                    246         1 KEEP   
R&gt; # … with abbreviated variable names ¹​perc.benchmark.dates,
R&gt; #   ²​threshold.decision</code></pre>
<p>Objeto <code>df.control</code> mostra que todos <em>tickers</em> foram válidos, com um total de 246 observações para cada ativo. Note que as datas batem 100% com o Ibovespa (coluna <code>perc.benchmark.dates</code>).</p>
<p>Quanto aos dados financeiros, esses estão contidos em <code>l_out$df.tickers</code>:</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print df_tickers</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">l_out</span><span class="op">$</span><span class="va">df.tickers</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 984
R&gt; Columns: 10
R&gt; $ price.open          &lt;dbl&gt; 29.36, 29.30, 29.84, 26.99, 28…
R&gt; $ price.high          &lt;dbl&gt; 29.82, 29.64, 30.67, 28.49, 28…
R&gt; $ price.low           &lt;dbl&gt; 28.81, 28.86, 29.48, 26.20, 28…
R&gt; $ price.close         &lt;dbl&gt; 29.47, 29.43, 29.60, 28.36, 28…
R&gt; $ volume              &lt;dbl&gt; 84672200, 129384600, 135078600…
R&gt; $ price.adjusted      &lt;dbl&gt; 15.33113, 15.31032, 15.39875, …
R&gt; $ ref.date            &lt;date&gt; 2021-11-29, 2021-11-30, 2021-…
R&gt; $ ticker              &lt;chr&gt; "PETR4.SA", "PETR4.SA", "PETR4…
R&gt; $ ret.adjusted.prices &lt;dbl&gt; NA, -0.0013573042, 0.005776432…
R&gt; $ ret.closing.prices  &lt;dbl&gt; NA, -0.0013572786, 0.005776418…</code></pre>
<p>Como esperado, a informação sobre preços, retornos e volumes está lá, com as devidas classes de colunas: <em>dbl</em> (<em>double</em>) para valores numéricos e <em>date</em> para as datas. Observe que uma coluna chamada <code>ticker</code> também está incluída. Essa indica em que linhas da tabela os dados de uma ação começam e terminam. Mais tarde, no capítulo <a href="limpando-estruturando.html#limpando-estruturando">9</a>, usaremos essa coluna para fazer diversos cálculos para cada ação.</p>
<div id="baixando-dados-da-composição-do-ibovespa" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Baixando Dados da Composição do Ibovespa<a class="anchor" aria-label="anchor" href="#baixando-dados-da-composi%C3%A7%C3%A3o-do-ibovespa"><i class="fas fa-link"></i></a>
</h3>
<p>Outra função útil do pacote é <code><a href="https://rdrr.io/pkg/BatchGetSymbols/man/GetIbovStocks.html">BatchGetSymbols::GetIbovStocks</a></code>, a qual importa a composição atual do índice Ibovespa diretamente do site da B3. Esse índice é um termômetro do mercado local e as ações que o compõem são selecionadas devido sua alta negociabilidade. Portanto, sequenciando o uso de <code>GetIbovStocks</code> e <code>BatchGetSymbols</code>, podemos facilmente baixar uma volumosa quantidade de dados de ações para o mercado Brasileiro. Considere o seguinte fragmento de código, onde realizamos essa operação: </p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">BatchGetSymbols</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set tickers</span></span>
<span><span class="va">df_ibov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BatchGetSymbols/man/GetIbovStocks.html">GetIbovStocks</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">my_tickers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">df_ibov</span><span class="op">$</span><span class="va">tickers</span>,<span class="st">'.SA'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># set dates and other inputs</span></span>
<span><span class="va">first_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">30</span></span>
<span><span class="va">last_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">thresh_bad_data</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>   <span class="co"># sets percent threshold for bad data</span></span>
<span><span class="va">bench_ticker</span> <span class="op">&lt;-</span> <span class="st">'^BVSP'</span>   <span class="co"># set benchmark as ibovespa</span></span>
<span><span class="va">cache_folder</span> <span class="op">&lt;-</span> <span class="st">'data/BGS_Cache'</span> <span class="co"># set folder for cache</span></span>
<span></span>
<span></span>
<span><span class="va">l_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BatchGetSymbols/man/BatchGetSymbols.html">BatchGetSymbols</a></span><span class="op">(</span>tickers <span class="op">=</span> <span class="va">my_tickers</span>,</span>
<span>                         first.date <span class="op">=</span> <span class="va">first_date</span>,</span>
<span>                         last.date <span class="op">=</span> <span class="va">last_date</span>,</span>
<span>                         bench.ticker <span class="op">=</span> <span class="va">bench_ticker</span>,</span>
<span>                         thresh.bad.data <span class="op">=</span> <span class="va">thresh_bad_data</span>,</span>
<span>                         cache.folder <span class="op">=</span> <span class="va">cache_folder</span><span class="op">)</span></span></code></pre></div>
<p>Note que utilizamos a função <code>paste0</code> para adicionar o texto <code>'.SA'</code> para cada <em>ticker</em> em <code>df_ibov$tickers</code>. A saída do código anterior não foi mostrada para não encher páginas e páginas com as mensagens do processamento. Destaco que, caso necessário, poderíamos facilmente exportar os dados em <code>l_out</code> para um arquivo <code>.rds</code> e futuramente carregá-los localmente para realizar algum tipo de análise.</p>
<div class="rmdcaution">
<p>
Saiba que <strong>os preços do Yahoo Finance não são ajustados a
dividendos</strong>. O ajuste realizado pelo sistema é apenas para
desdobramentos das ações. Isso significa que, ao olhar séries de preços
em um longo período, existe um viés de retorno para baixo. Ao comparar
com outro software que faça o ajustamento dos preços por dividendos,
verás uma grande diferença na rentabilidade total das ações. Como regra,
em uma pesquisa formal, <strong>evite usar dados de ações individuais no
Yahoo Finance para períodos longos</strong>. A excessão é para índices
financeiros, tal como o Ibovespa, onde os dados do Yahoo Finance são
bastante confiáveis uma vez que índices não sofrem os mesmos
ajustamentos que ações individuais.
</p>
</div>
</div>
</div>
<div id="pacote-gettddata" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Pacote <code>GetTDData</code><a class="anchor" aria-label="anchor" href="#pacote-gettddata"><i class="fas fa-link"></i></a>
</h2>
<p>Arquivos com informações sobre preços e retornos de títulos emitidos pelo governo brasileiro podem ser baixados manualmente no site do <a href="https://www.tesourodireto.com.br/">Tesouro Nacional</a>. O tesouro direto é um tipo especial de mercado onde pessoa física pode comprar e vender dívida pública. Os contratos de dívida vendidos na plataforma são bastante populares devido a atratividade das taxas de retorno e a alta liquidez oferecida ao investidor comum.</p>
<p>Pacote <code>GetTDData</code> importa os dados das planilhas em Excel do site do Tesouro Nacional e os organiza. O resultado é um <code>dataframe</code> com dados empilhados. Como exemplo, vamos baixar dados de um título prefixado do tipo LTN com vencimento em 2021-01-01. Esse é o tipo de contrato de dívida mais simples que o governo brasileiro emite, não pagando nenhum cupom<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;O cupom é um pagamento intermediário pago periodicamente durante a validade do contrato financeiro.&lt;/p&gt;"><sup>20</sup></a> durante sua validade e, na data de vencimento, retorna 1.000 R$ ao comprador. Para baixar os dados da internet, basta usar o código a seguir:</p>
<p> </p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetTDData/">GetTDData</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">asset_codes</span> <span class="op">&lt;-</span> <span class="st">'LTN'</span>   <span class="co"># Identifier of assets</span></span>
<span><span class="va">maturity</span> <span class="op">&lt;-</span> <span class="st">'010121'</span>  <span class="co"># Maturity date as string (ddmmyy)</span></span>
<span></span>
<span><span class="co"># download</span></span>
<span><span class="va">my_flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://msperlin.github.io/GetTDData/reference/download.TD.data.html">download.TD.data</a></span><span class="op">(</span>asset.codes <span class="op">=</span> <span class="va">asset_codes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read files</span></span>
<span><span class="va">df_TD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://msperlin.github.io/GetTDData/reference/read.TD.files.html">read.TD.files</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Vamos checar o conteúdo do dataframe:</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check content</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_TD</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 24,733
R&gt; Columns: 5
R&gt; $ ref.date   &lt;date&gt; 2002-03-18, 2002-03-19, 2002-03-20, 20…
R&gt; $ yield.bid  &lt;dbl&gt; 0.1977, 0.1975, 0.1967, 0.2005, 0.1983,…
R&gt; $ price.bid  &lt;dbl&gt; 720.96, 721.70, 723.09, 719.48, 722.38,…
R&gt; $ asset.code &lt;chr&gt; "LTN 070104", "LTN 070104", "LTN 070104…
R&gt; $ matur.date &lt;date&gt; 2004-01-07, 2004-01-07, 2004-01-07, 20…</code></pre>
<p>Temos informações sobre data de referência (<code>ref.date</code>), retorno contratado (<code>yield.bid</code>), preço do contrato na data (<code>price.bid</code>), nome do contrato (<code>asset.code</code>) e dia de maturidade (<code>matur.date</code>). No gráfico a seguir checamos os dados:</p>
<div class="inline-figure"><img src="adfeR_pt_ed03-ONLINE_files/figure-html/unnamed-chunk-188-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Como esperado de um título de dívida pré-fixado, os preços possuem uma tendência positiva ao longo do tempo, chegando ao valor esperado de 1000 R$ no vencimento em 2021-01-01. Podemos também visualizar as mudanças do <em>yield</em> do título:</p>
<div class="inline-figure"><img src="adfeR_pt_ed03-ONLINE_files/figure-html/unnamed-chunk-189-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Os retornos do título tiveram forte queda ao longo dos anos. Este resultado é esperado pois o juros do mercado – taxa SELIC – caiu bastante nos últimos cinco anos.</p>
<p>As funções do <code>GetTDData</code> também funcionam com vários argumentos como <code>asset.codes</code> e <code>maturity</code>. Suponhamos que desejamos visualizar todos os preços de todos os prazos disponíveis para títulos do tipo LTN a partir de 2010. Tudo o que precisamos fazer é adicionar o valor <code>NULL</code> ao argumento <code>maturity</code> e filtrar as datas:</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetTDData/">GetTDData</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">asset_codes</span> <span class="op">&lt;-</span> <span class="st">'LTN'</span>   <span class="co"># Name of asset</span></span>
<span><span class="va">maturity</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>      <span class="co"># = NULL, downloads all maturities</span></span>
<span></span>
<span><span class="co"># download data</span></span>
<span><span class="va">my_flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://msperlin.github.io/GetTDData/reference/download.TD.data.html">download.TD.data</a></span><span class="op">(</span>asset.codes <span class="op">=</span> <span class="va">asset_codes</span>,</span>
<span>                            do.clean.up <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reads data</span></span>
<span><span class="va">df_TD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://msperlin.github.io/GetTDData/reference/read.TD.files.html">read.TD.files</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove data prior to 2010</span></span>
<span><span class="va">df_TD</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df_TD</span>,</span>
<span>                       <span class="va">ref.date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2010-01-01'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Após a importação das informações, plotamos os preços dos diferentes ativos:</p>
<div class="inline-figure"><img src="adfeR_pt_ed03-ONLINE_files/figure-html/unnamed-chunk-191-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Note como todos contratos do tipo LTN terminam com valor R$ 1.000 em sua data de expiração e possuem uma dinâmica linear de crescimento de preço ao longo do tempo.</p>
<p>Outra funcionalidade do pacote <code>GetTDData</code> é o acesso a curva de juros atual do sistema financeiro brasileiro diretamente do <a href="https://www.anbima.com.br/pt_br/informar/curvas-de-juros-fechamento.htm">site da Anbima</a>. Para isso, basta utilizar a função <code>get.yield.curve</code>:</p>
<p></p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetTDData/">GetTDData</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get yield curve</span></span>
<span><span class="va">df_yield</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://msperlin.github.io/GetTDData/reference/get.yield.curve.html">get.yield.curve</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check result</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_yield</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 114
R&gt; Columns: 5
R&gt; $ n.biz.days   &lt;dbl&gt; 126, 252, 378, 504, 630, 756, 882, 10…
R&gt; $ type         &lt;chr&gt; "real_return", "real_return", "real_r…
R&gt; $ value        &lt;dbl&gt; 6.1355, 6.6490, 6.7057, 6.6214, 6.512…
R&gt; $ ref.date     &lt;date&gt; 2023-05-24, 2023-11-23, 2024-05-27, …
R&gt; $ current.date &lt;date&gt; 2022-11-22, 2022-11-22, 2022-11-22, …</code></pre>
<p>Os dados incluem a curva de juros nominal, juros real e da inflação. Para melhor visualizar as informações, vamos plotá-las em um gráfico:</p>
<div class="inline-figure"><img src="adfeR_pt_ed03-ONLINE_files/figure-html/unnamed-chunk-193-1.png" width="672" style="display: block; margin: auto;"></div>
<p>A curva de juros é uma ferramente utilizada no mercado financeiro com o propósito de representar graficamente a expectatica do mercado sobre juros futuro. Baseada nos preços dos títulos públicos, calcula-se e extrapola-se o juros implícito para cada período futuro. Uma curva ascendente, o formato esperado, indica que é mais caro (maior o juro) tomar dinheiro emprestado no longo prazo.</p>
</div>
<div id="pacote-getbcbdata" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Pacote <code>GetBCBData</code><a class="anchor" aria-label="anchor" href="#pacote-getbcbdata"><i class="fas fa-link"></i></a>
</h2>
<p>O Banco Central Brasileiro (BCB) disponibiliza em seu <a href="https://www3.bcb.gov.br/sgspub/localizarseries/localizarSeries.do?method=prepararTelaLocalizarSeries">Sistema de Séries Temporais (SGS)</a> uma vasta quantidade de tabelas relativas a economia do Brasil. Mais importante, estas tabelas são atualizadas constantemente e o acesso é gratuito e sem necessidade de registro.</p>
<p>Como um exemplo, vamos usar o pacote para estudar a inadimplência de crédito no sistema financeiro Brasileiro. O primeiro passo no uso de <code>GetBCBData</code> é procurar o símbolo da série de interesse. Acessando o <a href="https://www3.bcb.gov.br/sgspub/localizarseries/localizarSeries.do?method=prepararTelaLocalizarSeries">sistema de séries temporais do BCB</a>, vemos que o código identificador para o percentual total de inandimplência no Brasil é 21082.</p>
<p>No código, basta indicar a série de interesse e o período de tempo desejado:</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetBCBData/">GetBCBData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set ids and dates</span></span>
<span><span class="va">id_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>perc_default <span class="op">=</span> <span class="fl">21082</span><span class="op">)</span></span>
<span><span class="va">first_date</span> <span class="op">=</span> <span class="st">'2010-01-01'</span></span>
<span></span>
<span><span class="co"># get series from bcb</span></span>
<span><span class="va">df_cred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetBCBData/man/gbcbd_get_series.html">gbcbd_get_series</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">id_series</span>,</span>
<span>                            first.date <span class="op">=</span> <span class="va">first_date</span>,</span>
<span>                            last.date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            use.memoise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Fetching perc_default [21082] from BCB-SGS from Online API 
R&gt;   Found 139 observations</code></pre>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check it</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_cred</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 139
R&gt; Columns: 4
R&gt; $ ref.date    &lt;date&gt; 2011-03-01, 2011-04-01, 2011-05-01, 2…
R&gt; $ value       &lt;dbl&gt; 3.17, 3.24, 3.37, 3.32, 3.42, 3.45, 3.…
R&gt; $ id.num      &lt;dbl&gt; 21082, 21082, 21082, 21082, 21082, 210…
R&gt; $ series.name &lt;chr&gt; "perc_default", "perc_default", "perc_…</code></pre>
<p>Note que indicamos o nome da coluna na própria definição da entrada <code>id</code>. Assim, coluna <code>series.name</code> toma o nome de <code>perc.default</code>. Esta configuração é importante pois irá diferenciar os dados no caso da importação de diversas séries diferentes. O gráfico apresentado a seguir mostra o valor da série no tempo:</p>
<div class="inline-figure"><img src="adfeR_pt_ed03-ONLINE_files/figure-html/unnamed-chunk-195-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Como podemos ver, a percentagem de inadimplência aumentou a partir de 2015. Para ter uma idéia mais clara do problema, vamos incluir no gráfico a percentagem para pessoa física e pessoa jurídica. Olhando novamente o sistema do BCB, vemos que o símbolos de interesse são 21083 e 21084, respectivamente. O próximo código baixa os dados das duas séries.</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set ids</span></span>
<span><span class="va">id.series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>credit_default_people <span class="op">=</span> <span class="fl">21083</span>,</span>
<span>               credit_default_companies <span class="op">=</span> <span class="fl">21084</span><span class="op">)</span></span>
<span><span class="va">first.date</span> <span class="op">=</span> <span class="st">'2010-01-01'</span></span>
<span></span>
<span><span class="co"># get series from bcb</span></span>
<span><span class="va">df_cred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetBCBData/man/gbcbd_get_series.html">gbcbd_get_series</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">id.series</span>,</span>
<span>                            first.date <span class="op">=</span> <span class="va">first.date</span>,</span>
<span>                            last.date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                            use.memoise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Fetching credit_default_people [21083] from BCB-SGS from Online API 
R&gt;   Found 139 observations
R&gt; Fetching credit_default_companies [21084] from BCB-SGS from Online API 
R&gt;   Found 139 observations</code></pre>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check output</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_cred</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 278
R&gt; Columns: 4
R&gt; $ ref.date    &lt;date&gt; 2011-03-01, 2011-04-01, 2011-05-01, 2…
R&gt; $ value       &lt;dbl&gt; 1.96, 2.04, 2.15, 2.09, 2.18, 2.15, 2.…
R&gt; $ id.num      &lt;dbl&gt; 21083, 21083, 21083, 21083, 21083, 210…
R&gt; $ series.name &lt;chr&gt; "credit_default_people", "credit_defau…</code></pre>
<p>A diferença na saída do código anterior é que agora temos duas séries temporais empilhadas no mesmo <code>dataframe</code>. Partimos então para a visualização das séries</p>
<div class="inline-figure"><img src="adfeR_pt_ed03-ONLINE_files/figure-html/unnamed-chunk-197-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Como podemos ver, a inadimplência de crédito para pessoa física aumentou muito mais do que a para pessoa jurídica (empresas) nos últimos anos. Poderiámos, facilmente, integrar o código anterior para uma análise mais completa dos dados em algum problema de pesquisa.</p>
<div class="rmdimportant">
<p>
O sistema BCB-SGS é local obrigatório para qualquer economista sério.
A quantidade e variedade de dados é imensa. Podes usar os dados do
sistema para automatizar qualquer tipo de relatório econômico.
</p>
</div>
</div>
<div id="pacote-getdfpdata2" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Pacote <code>GetDFPData2</code><a class="anchor" aria-label="anchor" href="#pacote-getdfpdata2"><i class="fas fa-link"></i></a>
</h2>
<p>Pacote <code>GetDFPData2</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-GetDFPData2" role="doc-biblioref">M. Perlin and Kirch 2022a</a>)</span> é uma evolução do pacote <code>GetDFPData</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-GetDFPData" role="doc-biblioref">M. Perlin 2021</a>)</span> e fornece uma interface aberta para todas as demonstrações financeiras distribuídas pela B3 e pela CVM nos sistemas DFP (dados anuais) e ITR (dados trimestrais). Ele não só faz o <em>download</em> dos dados, mas também ajusta à inflação e torna as tabelas prontas para pesquisa dentro de um formato tabular. Os diferenciais do pacote em relação a outros distribuidores de dados comerciais são: livre acesso, facilidade para baixar dados em larga escala e a variedade de dados disponíveis.</p>
<div class="rmdimportant">
<p>
Uma versão web de <code>GetDFPData2</code> foi desenvolvida e
publicada na internet como um aplicativo <em>shiny</em> em <a href="http://www.msperlin.com/shiny/GetDFPData/">http://www.msperlin.com/shiny/GetDFPData/</a>.
Esse fornece uma interface gráfica direta e simples para as principais
funcionalidade do pacote. Usuários podem selecionar as empresas
disponíveis, o intervalo de datas e baixar os dados como uma planilha do
Excel ou um arquivo compactado com vários arquivos <em>csv</em>.
</p>
<p>
Saiba também que dados históricos completos e atualizados a partir de
2010 do DFP e ITR estão disponibilizados na seção <a href="https://www.msperlin.com/data/">Data</a> do meu site pessoal.
</p>
</div>
<p>O ponto de partida no uso de <code>GetDFPData2</code> é baixar informações atuais sobre empresas disponíveis. O acesso a tabela é possível com a função <code>get_info_companies</code>: </p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetDFPData2/">GetDFPData2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get info for companies in B3</span></span>
<span><span class="va">df_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetDFPData2/man/get_info_companies.html">get_info_companies</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Fetching info on B3 companies</code></pre>
<pre><code>R&gt;  Dowloading file from CVM</code></pre>
<pre><code>R&gt;  File not found, downloading it..</code></pre>
<pre><code>R&gt;  Success</code></pre>
<pre><code>R&gt;  Reading file from CVM</code></pre>
<pre><code>R&gt;  Saving cache data</code></pre>
<pre><code>R&gt;  Got 2559 lines for 2425 companies [Actives = 701 Inactives = 1736]</code></pre>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_info</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "CNPJ"               "DENOM_SOCIAL"      
R&gt;  [3] "DENOM_COMERC"       "DT_REG"            
R&gt;  [5] "DT_CONST"           "DT_CANCEL"         
R&gt;  [7] "MOTIVO_CANCEL"      "SIT_REG"           
R&gt;  [9] "DT_INI_SIT"         "CD_CVM"            
R&gt; [11] "SETOR_ATIV"         "TP_MERC"           
R&gt; [13] "CATEG_REG"          "DT_INI_CATEG"      
R&gt; [15] "SIT_EMISSOR"        "DT_INI_SIT_EMISSOR"
R&gt; [17] "CONTROLE_ACIONARIO" "TP_ENDER"          
R&gt; [19] "LOGRADOURO"         "COMPL"             
R&gt; [21] "BAIRRO"             "MUN"               
R&gt; [23] "UF"                 "PAIS"              
R&gt; [25] "CEP"                "DDD_TEL"           
R&gt; [27] "TEL"                "DDD_FAX"           
R&gt; [29] "FAX"                "EMAIL"             
R&gt; [31] "TP_RESP"            "RESP"              
R&gt; [33] "DT_INI_RESP"        "LOGRADOURO_RESP"   
R&gt; [35] "COMPL_RESP"         "BAIRRO_RESP"       
R&gt; [37] "MUN_RESP"           "UF_RESP"           
R&gt; [39] "PAIS_RESP"          "CEP_RESP"          
R&gt; [41] "DDD_TEL_RESP"       "TEL_RESP"          
R&gt; [43] "DDD_FAX_RESP"       "FAX_RESP"          
R&gt; [45] "EMAIL_RESP"         "CNPJ_AUDITOR"      
R&gt; [47] "AUDITOR"</code></pre>
<p>Essa tabela disponibiliza os identificadores numéricos das empresas, setores de atividades, atual segmento de governança, <em>tickers</em> negociados na bolsa e situação atual (ativa ou não). O número atual de empresas ativas e inativas, a partir de 2022-11-23, está disponível na coluna <code>SIT_REG</code>. Observa-se 786 empresas ativas e 1771 canceladas. Essa é uma excelente fonte de informação para um estudo exploratório. Pode-se facilmente filtrar empresas para datas, setores, <em>tickers</em> ou segmentos de governança corporativa.</p>
<p>Toda empresa no banco de dados é identificada pelo seu número único da CVM. Função <code>search_company</code> permite que o usuário procure o identificador de uma empresa através de seu nome. Dado um texto de entrada – o nome da empresa –, a função procurará uma correspondência parcial com os nomes de todas as empresas disponíveis no banco de dados. Em seu uso, caracteres latinos e maiúsculas e minúsculas são ignorados. Vamos encontrar o nome oficial nome da Grendene, uma das maiores empresas do Brasil. Para isso, basta usar o comando <code>search_company('grendene')</code>.</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetDFPData2/man/search_company.html">search_company</a></span><span class="op">(</span><span class="st">'grendene'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df_search</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 1 × 47
R&gt;   CNPJ      DENOM…¹ DENOM…² DT_REG     DT_CONST   DT_CANCEL
R&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;   
R&gt; 1 89.850.3… GRENDE… GRENDE… 2004-10-26 1971-02-25 NA       
R&gt; # … with 41 more variables: MOTIVO_CANCEL &lt;chr&gt;,
R&gt; #   SIT_REG &lt;chr&gt;, DT_INI_SIT &lt;date&gt;, CD_CVM &lt;dbl&gt;,
R&gt; #   SETOR_ATIV &lt;chr&gt;, TP_MERC &lt;chr&gt;, CATEG_REG &lt;chr&gt;,
R&gt; #   DT_INI_CATEG &lt;date&gt;, SIT_EMISSOR &lt;chr&gt;,
R&gt; #   DT_INI_SIT_EMISSOR &lt;date&gt;, CONTROLE_ACIONARIO &lt;chr&gt;,
R&gt; #   TP_ENDER &lt;chr&gt;, LOGRADOURO &lt;chr&gt;, COMPL &lt;chr&gt;,
R&gt; #   BAIRRO &lt;chr&gt;, MUN &lt;chr&gt;, UF &lt;chr&gt;, PAIS &lt;chr&gt;, …</code></pre>
<p>Vemos que existe um registro para a Grendene: “GRENDENE SA”, com código identificador equivalente a 19615. </p>
<p>Com o identificador da empresa disponível, usamos a função principal do pacote, <code>get_dfp_data</code>, para baixar os dados. Definimos o nome oficial da empresa como entrada <code>companies_cvm_codes</code> e o período de tempo como entradas <code>first_year</code> e <code>last_year</code>.</p>
<p></p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetDFPData2/">GetDFPData2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set options</span></span>
<span><span class="va">id_companies</span> <span class="op">&lt;-</span> <span class="fl">19615</span></span>
<span><span class="va">first_year</span> <span class="op">&lt;-</span> <span class="fl">2017</span></span>
<span><span class="va">last_year</span>  <span class="op">&lt;-</span> <span class="fl">2018</span></span>
<span></span>
<span><span class="co"># download data</span></span>
<span><span class="va">l_dfp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetDFPData2/man/get_dfp_data.html">get_dfp_data</a></span><span class="op">(</span>companies_cvm_codes <span class="op">=</span> <span class="va">id_companies</span>,</span>
<span>                      type_docs <span class="op">=</span> <span class="st">'*'</span>, <span class="co"># get all docs  </span></span>
<span>                      type_format <span class="op">=</span> <span class="st">'con'</span>, <span class="co"># consolidated</span></span>
<span>                      first_year <span class="op">=</span> <span class="va">first_year</span>,</span>
<span>                      last_year <span class="op">=</span> <span class="va">last_year</span><span class="op">)</span></span></code></pre></div>
<p>As mensagens de <code><a href="https://rdrr.io/pkg/GetDFPData2/man/get_dfp_data.html">GetDFPData2::get_dfp_data</a></code> relatam os estágios do processo, desde a aquisição de dados da tabela de referência ao download e leitura dos arquivos da B3. Observe que os arquivos de três sistemas são acessados: DFP (<em>Demostrativos Financeiros Padronizados</em>), FRE (<em>Formulário de Referência</em>) e FCA (<em>Formulário Cadastral</em>). Observe também o uso de um sistema de cache, o qual acelera significativamente o uso do software ao salvar localmente as informações importadas.</p>
<p>Explicando as demais entradas da função <code><a href="https://rdrr.io/pkg/GetDFPData2/man/get_dfp_data.html">GetDFPData2::get_dfp_data</a></code>:</p>
<dl>
<dt>companies_cvm_codes</dt>
<dd>
Código numérico das empresas (encontrado via <code>GetDFPData2::search_company('ambev')</code>)
</dd>
<dt>type_docs</dt>
<dd>
Símbolo do tipo de documento financeiro a ser retornado. Definições: ’*’ = retorna todos documentos, ‘BPA’ = Ativo, ‘BPP’ = passivo, ‘DRE’ = demonstrativo de resultados do exercício, ‘DFC_MD’ = fluxo de caixa pelo metodo direto, ‘DFC_MI’ = fluxo de caixa pelo metodo indireto, ‘DMPL’ = mutacoes do patrimonio liquido, ‘DVA’ = demonstrativo de valor agregado.
</dd>
<dt>type_format</dt>
<dd>
Tipo de formato dos documentos: consolidado (‘con’) ou individual (‘ind’). Como regra, dê preferência ao tipo consolidado, o qual incluirá dados completos de subsidiárias.
</dd>
<dt>first_year</dt>
<dd>
Primeiro ano para os dados
</dd>
<dt>last_year</dt>
<dd>
Último ano para os dados
</dd>
</dl>
<p>O objeto resultante de <code>get_dfp_data</code> é uma <code>lista</code> com diversas tabelas. Vamos dar uma olhada no conteúdo de <code>l_dfp</code> ao buscar os nomes dos itens da lista, limitando o número de caracteres:</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">l_dfp</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "DF Consolidado - Balanço Patrimonial Ati"
R&gt; [2] "DF Consolidado - Balanço Patrimonial Pas"
R&gt; [3] "DF Consolidado - Demonstração das Mutaçõ"
R&gt; [4] "DF Consolidado - Demonstração de Valor A"
R&gt; [5] "DF Consolidado - Demonstração do Fluxo d"
R&gt; [6] "DF Consolidado - Demonstração do Resulta"</code></pre>
<p>Como podemos ver, os dados retornados são vastos. Cada item da lista em <code>l_dfp</code> é um tabela indexada ao tempo. A explicação de cada coluna não cabe aqui mas, para fins de exemplo, vamos dar uma olhada no balanço patrimonial da empresa, disponível em <code>l_dfp$"DF Consolidado - Balanço Patrimonial Ativo"</code>:</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save assets in df</span></span>
<span><span class="va">fr_assets</span> <span class="op">&lt;-</span> <span class="va">l_dfp</span><span class="op">$</span><span class="va">`DF Consolidado - Balanço Patrimonial Ativo`</span></span>
<span></span>
<span><span class="co"># check it</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">fr_assets</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 122
R&gt; Columns: 16
R&gt; $ CNPJ_CIA     &lt;chr&gt; "89.850.341/0001-60", "89.850.341/000…
R&gt; $ CD_CVM       &lt;dbl&gt; 19615, 19615, 19615, 19615, 19615, 19…
R&gt; $ DT_REFER     &lt;date&gt; 2017-12-31, 2017-12-31, 2017-12-31, …
R&gt; $ DT_INI_EXERC &lt;date&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, …
R&gt; $ DT_FIM_EXERC &lt;date&gt; 2017-12-31, 2017-12-31, 2017-12-31, …
R&gt; $ DENOM_CIA    &lt;chr&gt; "GRENDENE S.A.", "GRENDENE S.A.", "GR…
R&gt; $ VERSAO       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
R&gt; $ GRUPO_DFP    &lt;chr&gt; "DF Consolidado - Balanço Patrimonial…
R&gt; $ MOEDA        &lt;chr&gt; "REAL", "REAL", "REAL", "REAL", "REAL…
R&gt; $ ESCALA_MOEDA &lt;chr&gt; "MIL", "MIL", "MIL", "MIL", "MIL", "M…
R&gt; $ ORDEM_EXERC  &lt;chr&gt; "ÚLTIMO", "ÚLTIMO", "ÚLTIMO", "ÚLTIMO…
R&gt; $ CD_CONTA     &lt;chr&gt; "1", "1.01", "1.01.01", "1.01.02", "1…
R&gt; $ DS_CONTA     &lt;chr&gt; "Ativo Total", "Ativo Circulante", "C…
R&gt; $ VL_CONTA     &lt;dbl&gt; 3576008, 2846997, 30119, 1537477, 836…
R&gt; $ COLUNA_DF    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
R&gt; $ source_file  &lt;chr&gt; "dfp_cia_aberta_BPA_con_2017.csv", "d…</code></pre>
<p>A exportação dos dados para o Excel também é fácil, basta usar função <code><a href="https://rdrr.io/pkg/GetDFPData2/man/export_xlsx.html">GetDFPData2::export_xlsx</a></code>: </p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_xlsx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.xlsx'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/GetDFPData2/man/export_xlsx.html">export_xlsx</a></span><span class="op">(</span>l_dfp <span class="op">=</span> <span class="va">l_dfp</span>, f_xlsx <span class="op">=</span> <span class="va">temp_xlsx</span><span class="op">)</span></span></code></pre></div>
<p>O arquivo Excel resultante conterá cada tabela de <code>l_dpf</code> em uma aba diferente da planilha, com uma truncagem nos nomes. Podemos checar o resultado com função <code><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">readxl::excel_sheets</a></code>:</p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">temp_xlsx</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "DF Consolidado - Balanço Pat"  
R&gt; [2] "DF Consolidado - Balanço Pat_1"
R&gt; [3] "DF Consolidado - Demonstraçã"  
R&gt; [4] "DF Consolidado - Demonstraçã_1"
R&gt; [5] "DF Consolidado - Demonstraçã_2"
R&gt; [6] "DF Consolidado - Demonstraçã_3"</code></pre>
</div>
<div id="pacote-getfredata" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Pacote <code>GetFREData</code><a class="anchor" aria-label="anchor" href="#pacote-getfredata"><i class="fas fa-link"></i></a>
</h2>
<p>O pacote <code>GetFREData</code> importa dados do sistema FRE – Formulário de Referência – da bolsa Brasileira, incluindo eventos e informações corporativas tal como composição do conselho e diretoria, remuneração dos conselhos, entre outras.</p>
<p>A estrutura de uso e a saída das funções de <code>GetFREData</code> são muito semelhante as do pacote <code>GetDFPData2</code>. Veja a seguir um exemplo de uso.</p>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/msperlin/GetFREData/">GetFREData</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set options</span></span>
<span><span class="va">id_companies</span> <span class="op">&lt;-</span> <span class="fl">23264</span></span>
<span><span class="va">first_year</span> <span class="op">&lt;-</span> <span class="fl">2017</span></span>
<span><span class="va">last_year</span>  <span class="op">&lt;-</span> <span class="fl">2018</span></span>
<span></span>
<span><span class="co"># download data</span></span>
<span><span class="va">l_fre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GetFREData/man/get_fre_data.html">get_fre_data</a></span><span class="op">(</span>companies_cvm_codes <span class="op">=</span> <span class="va">id_companies</span>,</span>
<span>                      first_year <span class="op">=</span> <span class="va">first_year</span>,</span>
<span>                      last_year <span class="op">=</span> <span class="va">last_year</span><span class="op">)</span></span></code></pre></div>
<p>Note que o tempo de execução de <code>get_fre_data</code> é significativo. Isto deve-se ao <em>download</em> e leitura dos arquivos do sistema FRE direto da bolsa. Cada tabela do FRE é importada na lista de saída:</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">l_fre</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "df_stockholders"            
R&gt;  [2] "df_capital"                 
R&gt;  [3] "df_stock_values"            
R&gt;  [4] "df_mkt_value"               
R&gt;  [5] "df_increase_capital"        
R&gt;  [6] "df_capital_reduction"       
R&gt;  [7] "df_compensation"            
R&gt;  [8] "df_compensation_summary"    
R&gt;  [9] "df_transactions_related"    
R&gt; [10] "df_other_events"            
R&gt; [11] "df_stock_repurchases"       
R&gt; [12] "df_debt_composition"        
R&gt; [13] "df_board_composition"       
R&gt; [14] "df_committee_composition"   
R&gt; [15] "df_family_relations"        
R&gt; [16] "df_family_related_companies"
R&gt; [17] "df_auditing"                
R&gt; [18] "df_responsible_docs"        
R&gt; [19] "df_stocks_details"          
R&gt; [20] "df_dividends_details"       
R&gt; [21] "df_intangible_details"</code></pre>
<p>Por exemplo, vamos verificar conteúdo da tabela <code>df_board_composition</code>, a qual contém informações sobre os componentes dos conselhos das empresas:</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">l_fre</span><span class="op">$</span><span class="va">df_board_composition</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 59
R&gt; Columns: 22
R&gt; $ CNPJ_CIA                 &lt;chr&gt; "07.526.557/0001-00", "07…
R&gt; $ DENOM_CIA                &lt;chr&gt; "AMBEV S.A.", "AMBEV S.A.…
R&gt; $ DT_REFER                 &lt;date&gt; 2017-01-01, 2017-01-01, …
R&gt; $ CD_CVM                   &lt;dbl&gt; 23264, 23264, 23264, 2326…
R&gt; $ ID_DOC                   &lt;dbl&gt; 74969, 74969, 74969, 7496…
R&gt; $ VERSAO                   &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 1…
R&gt; $ person.name              &lt;chr&gt; "Paula Nogueira Lindenber…
R&gt; $ person.cpf               &lt;dbl&gt; 26712117836, 25661215835,…
R&gt; $ person.profession        &lt;chr&gt; "Administradora", "Engenh…
R&gt; $ person.cv                &lt;chr&gt; "Nos últimos 5 anos, ocup…
R&gt; $ person.dob               &lt;date&gt; NA, NA, NA, NA, NA, NA, …
R&gt; $ code.type.board          &lt;chr&gt; "1", "1", "1", "1", "1", …
R&gt; $ desc.type.board          &lt;chr&gt; "Director", "Director", "…
R&gt; $ desc.type.board2         &lt;chr&gt; "Diretora de Marketing", …
R&gt; $ code.type.job            &lt;chr&gt; "19", "19", "19", "19", "…
R&gt; $ desc.job                 &lt;chr&gt; "Não aplicável, uma vez q…
R&gt; $ date.election            &lt;date&gt; 2016-05-11, 2016-05-11, …
R&gt; $ date.effective           &lt;date&gt; 2016-05-11, 2016-05-11, …
R&gt; $ mandate.duration         &lt;chr&gt; "11/05/2019", "30/06/2018…
R&gt; $ ellected.by.controller   &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, T…
R&gt; $ qtd.consecutive.mandates &lt;dbl&gt; 2, 2, 2, 2, 2, 1, 2, 1, 1…
R&gt; $ percentage.participation &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0…</code></pre>
<p>Como podemos ver, para um pesquisador de finanças corporativas, o sistema FRE oferece uma série de informações interessantes. Discutir o conteúdo de cada tabela, porém, vai muito além do propósito dessa seção. Aos interessados, mais detalhes sobre as tabelas do FRE estão disponíveis em <span class="citation">M. Perlin, Kirch, and Vancin (<a href="refer%C3%AAncias.html#ref-perlin2018accessing" role="doc-biblioref">2018</a>)</span>.</p>
<div class="rmdimportant">
<p>
Note que a importação dos dados do FRE inclui uma versão dos
arquivos. Toda vez que uma empresa modifica as informações oficiais no
sistema da B3, uma nova versão do FRE é criada. Devido a isso, é
bastante comum que os dados de um ano para uma empresa possua diferentes
versões. Para resolver este problema, o código do
<code>GetFREData</code>, por <em>default</em>, importa a versão mais
antiga para cada ano. Caso o usuário queira mudar, basta utilizar a
entrada <code>fre_to_read</code>.
</p>
</div>
</div>
<div id="outros-pacotes" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Outros Pacotes<a class="anchor" aria-label="anchor" href="#outros-pacotes"><i class="fas fa-link"></i></a>
</h2>
<p>Nas seções anteriores destacamos os principais pacotes gratuitos para aquisição de dados financeiros e econômicos no Brasil. Muitos desses foram escritos pelo próprio autor do livro e representam uma pequena parcela da totalidade. Não seria justo ignorar o trabalho de outros autores. Assim, reporto abaixo uma seleção de pacotes que vale a pena conhecer:</p>
<div id="pacotes-de-acesso-gratuito" class="section level3" number="5.7.1">
<h3>
<span class="header-section-number">5.7.1</span> Pacotes de Acesso Gratuito<a class="anchor" aria-label="anchor" href="#pacotes-de-acesso-gratuito"><i class="fas fa-link"></i></a>
</h3>
<dl>
<dt>
<code>BETS</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-BETS" role="doc-biblioref">Ferreira, Speranza, and Costa 2018</a>)</span>
</dt>
<dd>
Pacote construído e mantido pela equipe da <a href="http://portal.fgv.br/en">FGV</a>. Permite o acesso aos dados do BCB (Banco Central do Brasil) e IBGE (Instituto Brasileiro de Geografia e Estatística). Também inclui ferramentas para a administração, análise e manipulação dos dados em relatórios técnicos.
</dd>
<dt>
<code>simfinapi</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-simfinapi" role="doc-biblioref">Gomolka 2021</a>)</span>
</dt>
<dd>
Pacote para acesso ao projeto <a href="https://simfin.com/">simfin</a>, incluindo dados financeiros de diversas empresas internacionais. O acesso livre é restrito a um número de chamadas diárias.
</dd>
</dl>
</div>
<div id="pacotes-comerciais" class="section level3" number="5.7.2">
<h3>
<span class="header-section-number">5.7.2</span> Pacotes Comerciais<a class="anchor" aria-label="anchor" href="#pacotes-comerciais"><i class="fas fa-link"></i></a>
</h3>
<dl>
<dt>
<code>Rblpapi</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-Rblpapi" role="doc-biblioref">Armstrong, Eddelbuettel, and Laing 2022</a>)</span>
</dt>
<dd>
Permite acesso aos dados da <a href="https://www.bloomberg.com/">Bloomberg</a>, sendo necessário uma conta comercial.
</dd>
<dt>
<code>IBrokers</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-IBrokers" role="doc-biblioref">Ryan and Ulrich 2022a</a>)</span>
</dt>
<dd>
API para o acesso aos dados da <a href="https://www.interactivebrokers.com/en/home.php">Interactive Brokers</a>. Também é necessário uma conta comercial.
</dd>
</dl>
<p>No CRAN você encontrará muitos outros. A interface para fontes de dados comerciais também é possível. Várias empresas fornecem APIs para facilitar o envio de dados aos seus clientes. Se a empresa de fornecimento de dados que você usa no trabalho não for apresentada aqui, a <a href="https://cran.r-project.org/">lista de pacotes CRAN</a> pode ajudá-lo a encontrar uma alternativa viável.</p>
</div>
</div>
<div id="acessando-dados-de-páginas-na-internet-webscraping" class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> Acessando Dados de Páginas na Internet (<em>Webscraping</em>)<a class="anchor" aria-label="anchor" href="#acessando-dados-de-p%C3%A1ginas-na-internet-webscraping"><i class="fas fa-link"></i></a>
</h2>
<p>Os pacotes destacados anteriormente são muito úteis pois facilitam a importação de dados específicos diretamente da internet. Em muitos casos, porém, os dados de interesse não estão disponíveis via API formal, mas sim em uma página na internet - geralmente no formato de uma tabela. O processo de extrair informações de páginas da internet chama-se <em>webscraping</em> (raspagem de dados). Dependendo da estrutura e da tecnologia da página da <em>web</em> acessada, importar essas informações diretamente para o R pode ser um procedimento trivial – mas também pode se tornar um processo extremamente trabalhoso. Como um exemplo, a seguir vamos raspar dados do Wikipedia sobre a composição do índice SP500.</p>
<div id="raspando-dados-do-wikipedia" class="section level3" number="5.8.1">
<h3>
<span class="header-section-number">5.8.1</span> Raspando Dados do Wikipedia<a class="anchor" aria-label="anchor" href="#raspando-dados-do-wikipedia"><i class="fas fa-link"></i></a>
</h3>
<p>Em seu site, a Wikipedia oferece uma <a href="https://en.wikipedia.org/wiki/List_of_S%26P_500_companies">seção</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/List_of_S%26P_500_companies" class="uri"&gt;https://en.wikipedia.org/wiki/List_of_S%26P_500_companies&lt;/a&gt;&lt;/p&gt;'><sup>21</sup></a> com os componentes do Índice SP500. Essas informações são apresentadas em um formato tabular, Figura <a href="importacao-pacotes.html#fig:SP500-wikipedia">5.1</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:SP500-wikipedia"></span>
<img src="00-text-resources/figs/SP500-Wikipedia.png" alt="Imagem da página do Wikipedia" width="75%"><p class="caption">
Figura 5.1: Imagem da página do Wikipedia
</p>
</div>
<p>As informações desta página são constantemente atualizadas, e podemos utilizá-las para importar informações sobre as ações pertencentes ao índice SP500. Antes de nos aprofundarmos no código R, precisamos entender como uma página da web funciona. Resumidamente, uma página da web nada mais é do que uma árvore com nódulos, representada por um código HTML (<em>Hypertext Markup Language</em>) extenso interpretado pelo seu navegador. Um valor numérico ou texto apresentado no site geralmente pode ser encontrado dentro do próprio código. Este código tem uma estrutura particular em forma de árvore com ramificações, classes, nomes e identificadores. Além disso, cada elemento de uma página da web possui um endereço, denominado <em>xpath</em>. Nos navegadores Chrome e Firefox, você pode ver o código HTML de uma página da web usando o mouse. Para isto, basta clicar com o botão direito em qualquer parte da página e selecionar <em>View Page Source</em> (ou “Ver Código Fonte”).</p>
<p>A primeira etapa do processo de raspagem de dados é descobrir a localização das informações de que você precisa. No navegador Chrome, você pode fazer isso clicando com o botão direito no local específico do número/texto no site e selecionando <em>inspect</em>. Isso abrirá uma janela extra no navegador a direita. Depois de fazer isso, clique com o botão direito na seleção e escolha <em>copy</em> e <em>copy xpath</em>. Na Figura <a href="importacao-pacotes.html#fig:SP500-Wikipedia-webscraping">5.2</a>, vemos um espelho do que você deve estar vendo em seu navegador.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:SP500-Wikipedia-webscraping"></span>
<img src="00-text-resources/figs/SP500-Wikipedia_webscraping.png" alt="Encontrando o xpath da tabela" width="75%"><p class="caption">
Figura 5.2: Encontrando o xpath da tabela
</p>
</div>
<p>Aqui, o texto copiado é:</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="st">'//*[@id="mw-content-text"]/table[1]/thead/tr/th[2]'</span></span></code></pre></div>
<p>Este é o endereço do cabeçalho da tabela. Para todo o conteúdo da tabela, incluindo cabeçalho, linhas e colunas, precisamos definir um nível superior da árvore. Isso é equivalente ao endereço <code>//*[@id =" mw-content-text"]/table[1]</code>.</p>
<p>Agora que temos a localização do que queremos, vamos carregar o pacote <code>rvest</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-rvest" role="doc-biblioref">Wickham 2022a</a>)</span> e usar as funções <code>read_html</code>, <code>html_nodes</code> e<code>html_table</code> para importar a tabela desejada para o R: </p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set url and xpath</span></span>
<span><span class="va">my_url</span> <span class="op">&lt;-</span> <span class="st">'https://en.wikipedia.org/wiki/List_of_S%26P_500_companies'</span></span>
<span><span class="va">my_xpath</span> <span class="op">&lt;-</span> <span class="st">'//*[@id="mw-content-text"]/div/table[1]'</span></span>
<span></span>
<span><span class="co"># get nodes from html</span></span>
<span><span class="va">out_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">my_url</span><span class="op">)</span>,</span>
<span>                        xpath <span class="op">=</span> <span class="va">my_xpath</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get table from nodes (each element in </span></span>
<span><span class="co"># list is a table)</span></span>
<span><span class="va">df_SP500_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span><span class="va">out_nodes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># isolate it </span></span>
<span><span class="va">df_SP500_comp</span> <span class="op">&lt;-</span> <span class="va">df_SP500_comp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># change column names (remove space)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_SP500_comp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df_SP500_comp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_SP500_comp</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 503
R&gt; Columns: 9
R&gt; $ Symbol                &lt;chr&gt; "MMM", "AOS", "ABT", "ABBV",…
R&gt; $ Security              &lt;chr&gt; "3M", "A. O. Smith", "Abbott…
R&gt; $ SEC.filings           &lt;chr&gt; "reports", "reports", "repor…
R&gt; $ GICS.Sector           &lt;chr&gt; "Industrials", "Industrials"…
R&gt; $ GICS.Sub.Industry     &lt;chr&gt; "Industrial Conglomerates", …
R&gt; $ Headquarters.Location &lt;chr&gt; "Saint Paul, Minnesota", "Mi…
R&gt; $ Date.first.added      &lt;chr&gt; "1976-08-09", "2017-07-26", …
R&gt; $ CIK                   &lt;int&gt; 66740, 91142, 1800, 1551152,…
R&gt; $ Founded               &lt;chr&gt; "1902", "1916", "1888", "201…</code></pre>
<p>O objeto <code>df_SP500_comp</code> contém um espelho dos dados do site da Wikipedia. Os nomes das colunas requerem algum trabalho de limpeza, mas o principal está ali. Observe como a saída é semelhante aos dados da função <code><a href="https://rdrr.io/pkg/BatchGetSymbols/man/GetSP500Stocks.html">BatchGetSymbols::GetSP500Stocks</a></code>. A razão é simples, ambas buscaram a informação na mesma origem. A diferença é que função <code>GetSP500Stocks</code> vai um passo além, limpando os dados importados.</p>
</div>
</div>
<div id="exerc-importacao-pacotes" class="section level2" number="5.9">
<h2>
<span class="header-section-number">5.9</span> Exercícios<a class="anchor" aria-label="anchor" href="#exerc-importacao-pacotes"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><span id="webex-total_correct"></span></p>
<div id="q.1-4" class="section level3 unnumbered">
<h3>Q.1<a class="anchor" aria-label="anchor" href="#q.1-4"><i class="fas fa-link"></i></a>
</h3>
<p>Using the <code>yfR</code> package, download daily data for ticker TSLA from <em>Yahoo Finance</em> for the period between 2019-01-01 and 2020-03-02. What is the lowest <strong>unadjusted closing price (column <code>price_close</code>)</strong> in the analyzed period?</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="">21.45756</option>
<option value="">13.51713</option>
<option value="">18.81075</option>
<option value="">16.16394</option>
<option value="answer">11.93133</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf500bdcf" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf500bdcf" class="collapse">
A solução é 11.93133. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code>possible_tickers &lt;- c('META', "TSLA", "MMM", "GE")
ticker &lt;- sample(possible_tickers, 1)
first_date &lt;- as.Date('2019-01-01')
last_date  &lt;- sample(
  seq(first_date+50, Sys.Date()-10, by = '1 day'),
  1)

df_prices &lt;- yfR::yf_get(tickers = ticker, 
                         first_date = first_date, 
                         last_date = last_date)

my_sol &lt;- min(df_prices$price_close, 
              na.rm = TRUE)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.2-4" class="section level3 unnumbered">
<h3>Q.2<a class="anchor" aria-label="anchor" href="#q.2-4"><i class="fas fa-link"></i></a>
</h3>
<p>If you have not already done so, create a profile on the <a href="https://www.quandl.com/">Quandl website</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.quandl.com/" class="uri"&gt;https://www.quandl.com/&lt;/a&gt;&lt;/p&gt;'><sup>22</sup></a> and download the arabica coffee price data (id = CEPEA/COFFEE_A) in the CEPEA database (Center for Advanced Studies in Applied Economics) between 2010-01-01 and 2019-09-27. What is the maximum price found?</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="">$462.96</option>
<option value="">$614.59</option>
<option value="">$538.78</option>
<option value="">$387.15</option>
<option value="answer">$349.39</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf16ceb999" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf16ceb999" class="collapse">
A solução é $349.39. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code><a href="https://github.com/msperlin/GetQuandlData/">library(GetQuandlData)

id_series &lt;- c('CEPEA/COFFEE_A')

# set api key (make sure you got your own!)
my_api_key &lt;- readLines('~/GDrive/98-pass-and-bash/.quandl_api.txt')

first_date &lt;- as.Date('2010-01-01')
last_date &lt;- sample(
  seq(first_date + 50, 
      Sys.Date(), by = '1 day'),
  1)

df_coffee &lt;- get_Quandl_series(id_in = id_series, 
                               first_date = first_date,
                               last_date = last_date,
                               api_key = my_api_key,
                               do_cache = TRUE)

# find max
my_sol &lt;- max(as.numeric(df_coffee$`Cash Price US$`))</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.3-3" class="section level3 unnumbered">
<h3>Q.3<a class="anchor" aria-label="anchor" href="#q.3-3"><i class="fas fa-link"></i></a>
</h3>
<p>Utilize pacote <code>GetBCBData</code> para baixar dados do IPCA mensal entre 2010-01-01 e 2020-12-31. Para os dados importados, qual é a data com o maior valor mensal de inflação?</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="">2018-11-01</option>
<option value="">2018-10-01</option>
<option value="">2018-02-01</option>
<option value="answer">2020-12-01</option>
<option value="">2014-08-01</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf2cbaeb41" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf2cbaeb41" class="collapse">
A solução é 2020-12-01. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code><a href="https://github.com/msperlin/GetBCBData/">library(GetBCBData)

id_series &lt;- '433'
first_date &lt;- '2010-01-01'
last_date &lt;- '2020-12-31'

df_ipca &lt;- gbcbd_get_series(id = id_series,
                            first.date = first_date,
                            last.date = last_date, 
                            use.memoise = FALSE)

my_sol &lt;-  df_ipca$ref.date[which.max(df_ipca$value)]</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.4-3" class="section level3 unnumbered">
<h3>Q.4<a class="anchor" aria-label="anchor" href="#q.4-3"><i class="fas fa-link"></i></a>
</h3>
<p>Use function <code><a href="https://rdrr.io/pkg/simfinapi/man/sfa_get_entities.html">simfinapi::sfa_get_entities</a></code> to import data about all available companies in <a href="https://simfin.com">Simfin</a>. How many companies do you find?</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="">8382</option>
<option value="answer">3229</option>
<option value="">5153</option>
<option value="">2552</option>
<option value="">1465</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf71388165" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf71388165" class="collapse">
A solução é 3229. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code><a href="https://github.com/msperlin/simfinR/">library(simfinR)
library(tidyverse)

# set api key - make sure you got your own at https://simfin.com/data/access/api
my_api_key &lt;- read_lines('~/GDrive/98-pass-and-bash/.api_key_simfin.txt')

df_info &lt;- simfinapi::sfa_get_entities(api_key = my_api_key, 
                                       cache_dir = tempdir())

# check it
n_companies &lt;- n_distinct(df_info$simfin_id)

my_sol &lt;- n_companies</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.5-3" class="section level3 unnumbered">
<h3>Q.5<a class="anchor" aria-label="anchor" href="#q.5-3"><i class="fas fa-link"></i></a>
</h3>
<p>With package <code>simfinapi</code>, download the PnL (profit and loss) statement for FY (final year) data for id = 134979) for year 2019. What is the latest “Net Income” of the company?</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="answer">$76,930,000</option>
<option value="">$11,110,183</option>
<option value="">$55,274,533</option>
<option value="">$40,553,083</option>
<option value="">$25,831,633</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf4cf0e49c" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf4cf0e49c" class="collapse">
A solução é $76,930,000. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

# set api key - make sure you got your own at https://simfin.com/data/access/api
my_api_key &lt;- read_lines('~/GDrive/98-pass-and-bash/.api_key_simfin.txt')

df_info &lt;- simfinapi::sfa_get_entities(api_key = my_api_key, 
                                       cache_dir = tempdir())

company_id &lt;- sample(df_info$simfin_id, 1)
type_statements &lt;- 'pl' # profit/loss
periods = 'FY' # final year
year = sample(2015:2020, 1)

df_pl &lt;- simfinapi::sfa_get_statement(simfin_id = company_id, 
                             statement = 'pl', 
                             fyear = year, api_key = my_api_key,
                             cache_dir = tempdir())

my_sol &lt;- df_pl$net_income</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.6-3" class="section level3 unnumbered">
<h3>Q.6<a class="anchor" aria-label="anchor" href="#q.6-3"><i class="fas fa-link"></i></a>
</h3>
<p>Using again the <code>yfR</code> package, download data between 2019-01-01 and 2021-05-30 for the following tickers:</p>
<ul>
<li>AAPL: Apple Inc</li>
<li>BAC: Bank of America Corporation</li>
<li>GE: General Electric Company</li>
<li>TSLA: Tesla, Inc.</li>
<li>SNAP: Snap Inc.</li>
</ul>
<p>Using the <strong>adjusted closing price</strong> column, what company provided higher return to the stock holder during the analyzed period?</p>
<p>Tip: this is an advanced exercise that will require some coding. To solve it, check out function <code>split</code> to split the dataframe of price data and <code>lapply</code> to map a function to each dataframe.</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="">TSLA</option>
<option value="answer">SNAP</option>
<option value="">BAC</option>
<option value="">AAPL</option>
<option value="">GE</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf77505d30" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf77505d30" class="collapse">
A solução é SNAP. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code>first_date &lt;- as.Date('2019-01-01')
last_date  &lt;- sample(
  seq(first_date+50, Sys.Date()-10, by = '1 day'),
  1)

my_tickers &lt;- c('AAPL', 'BAC', 
                'GE', 'TSLA',
                'SNAP')

df_prices &lt;- yfR::yf_get(tickers = my_tickers, 
                         first_date = first_date, 
                         last_date = last_date)

split_l &lt;- split(df_prices, df_prices$ticker)

my_fct &lt;- function(df_in) {
  price_vec &lt;- df_in$price_adjusted
  ticker_in &lt;- df_in$ticker[1]
  
  total_ret &lt;- last(price_vec)/first(price_vec) - 1
  
  return(tibble(ticker = ticker_in,
                total_ret = total_ret))
}

df_results &lt;- bind_rows(
  lapply(split_l, my_fct)
)

winner &lt;- df_results$ticker[which.max(df_results$total_ret)]

my_sol &lt;- winner</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.7-3" class="section level3 unnumbered">
<h3>Q.7<a class="anchor" aria-label="anchor" href="#q.7-3"><i class="fas fa-link"></i></a>
</h3>
<p>Using package <code>GetDFPData2</code>, download the main table with all available companies. What is the number of active companies currently available?</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="">1986</option>
<option value="">353</option>
<option value="">1200</option>
<option value="">573</option>
<option value="answer">786</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf5ffee31e" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf5ffee31e" class="collapse">
A solução é 786. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code>df_info &lt;- GetDFPData2::get_info_companies() |&gt;
  dplyr::filter(SIT_REG == "ATIVO")

my_sol &lt;- nrow(df_info)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.8-2" class="section level3 unnumbered">
<h3>Q.8<a class="anchor" aria-label="anchor" href="#q.8-2"><i class="fas fa-link"></i></a>
</h3>
<p>Using package <code>GetDFPData2</code>, download net income data (consolidated) for all companies in the year of 2019. What is the sum of profit/loss (in thousands, code 3.11 in DFP) for all companies?</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="answer">$671,404,363</option>
<option value="">$515,670,717</option>
<option value="">$310,949,685</option>
<option value="">$1,833,169,063</option>
<option value="">$1,161,764,700</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf3791fe5d" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf3791fe5d" class="collapse">
A solução é $671,404,363. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code>df_info &lt;- GetDFPData2::get_info_companies() |&gt;
  dplyr::filter(SIT_REG == "ATIVO")

year &lt;- sample(2015:(lubridate::year(Sys.Date())-1), 1)

l_dfp &lt;- GetDFPData2::get_dfp_data(first_year = year, 
                                   last_year = year)

ni &lt;- l_dfp$`DF Consolidado - Demonstração do Resultado` |&gt;
  dplyr::filter(CD_CONTA == "3.11")

my_sol &lt;- sum(ni$VL_CONTA)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.9-2" class="section level3 unnumbered">
<h3>Q.9<a class="anchor" aria-label="anchor" href="#q.9-2"><i class="fas fa-link"></i></a>
</h3>
<p>Using package <code>GetTDData</code>, download all available data for debt contract of type LTN (<em>pré-fixados</em>).</p>
<p>What is the maximum yield (column <em>yield.bid</em>) found for for contract LTN 010118?</p>
<br> Resposta: <select class="webex-select"><option value="blank"></option>
<option value="">22.9%</option>
<option value="answer">16.7%</option>
<option value="">19.3%</option>
<option value="">26.4%</option>
<option value="">29.9%</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_11cf5bccd257" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_11cf5bccd257" class="collapse">
A solução é 16.7%. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre><code>my_temp_path &lt;- fs::path_temp('TD')
GetTDData::download.TD.data(asset.codes = "LTN", 
                            dl.folder = my_temp_path)

df_td &lt;- GetTDData::read.TD.files(dl.folder = my_temp_path)

available_assets &lt;- unique(df_td$asset.code)
my_asset &lt;- sample(available_assets, 1)

df_asset &lt;- df_td |&gt;
  dplyr::filter(asset.code == my_asset)

my_sol &lt;- max(df_asset$yield.bid)</code></pre>
</div>
</div>

</div>
</div>
</div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://padfer.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
  <div class="chapter-nav">
<div class="prev"><a href="importacao-exportacao.html"><span class="header-section-number">4</span> Importação e Exportação de Dados Locais</a></div>
<div class="next"><a href="classe-estrutura.html"><span class="header-section-number">6</span> Dataframes e outros Objetos</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#importacao-pacotes"><span class="header-section-number">5</span> Importação de Dados via Pacotes</a></li>
<li>
<a class="nav-link" href="#quandl"><span class="header-section-number">5.1</span> Pacote GetQuandlData</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#importando-m%C3%BAltiplas-s%C3%A9ries"><span class="header-section-number">5.1.1</span> Importando Múltiplas Séries</a></li></ul>
</li>
<li>
<a class="nav-link" href="#pacote-batchgetsymbols"><span class="header-section-number">5.2</span> Pacote BatchGetSymbols</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#baixando-dados-da-composi%C3%A7%C3%A3o-do-ibovespa"><span class="header-section-number">5.2.1</span> Baixando Dados da Composição do Ibovespa</a></li></ul>
</li>
<li><a class="nav-link" href="#pacote-gettddata"><span class="header-section-number">5.3</span> Pacote GetTDData</a></li>
<li><a class="nav-link" href="#pacote-getbcbdata"><span class="header-section-number">5.4</span> Pacote GetBCBData</a></li>
<li><a class="nav-link" href="#pacote-getdfpdata2"><span class="header-section-number">5.5</span> Pacote GetDFPData2</a></li>
<li><a class="nav-link" href="#pacote-getfredata"><span class="header-section-number">5.6</span> Pacote GetFREData</a></li>
<li>
<a class="nav-link" href="#outros-pacotes"><span class="header-section-number">5.7</span> Outros Pacotes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pacotes-de-acesso-gratuito"><span class="header-section-number">5.7.1</span> Pacotes de Acesso Gratuito</a></li>
<li><a class="nav-link" href="#pacotes-comerciais"><span class="header-section-number">5.7.2</span> Pacotes Comerciais</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#acessando-dados-de-p%C3%A1ginas-na-internet-webscraping"><span class="header-section-number">5.8</span> Acessando Dados de Páginas na Internet (Webscraping)</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#raspando-dados-do-wikipedia"><span class="header-section-number">5.8.1</span> Raspando Dados do Wikipedia</a></li></ul>
</li>
<li>
<a class="nav-link" href="#exerc-importacao-pacotes"><span class="header-section-number">5.9</span> Exercícios</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#q.1-4">Q.1</a></li>
<li><a class="nav-link" href="#q.2-4">Q.2</a></li>
<li><a class="nav-link" href="#q.3-3">Q.3</a></li>
<li><a class="nav-link" href="#q.4-3">Q.4</a></li>
<li><a class="nav-link" href="#q.5-3">Q.5</a></li>
<li><a class="nav-link" href="#q.6-3">Q.6</a></li>
<li><a class="nav-link" href="#q.7-3">Q.7</a></li>
<li><a class="nav-link" href="#q.8-2">Q.8</a></li>
<li><a class="nav-link" href="#q.9-2">Q.9</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Análise de Dados Financeiros e Econômicos com o R - Versão Online</strong>" was written by Marcelo S. Perlin (<a href="mailto:marcelo.perlin@ufrgs.br" class="email">marcelo.perlin@ufrgs.br</a>). It was last built on 2022-11-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
